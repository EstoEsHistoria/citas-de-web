<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Citas APA Universal</title>
    <!-- Metadato de autor para esta página -->
    <meta name="author" content="Esto Es Historia">
    <!-- Metadato de año de creación para esta página -->
    <meta name="creation_year" content="2025">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter (para el cuerpo) y Playfair Display (para el título principal) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #dad7d7; /* Color de fondo de la página: HEX #dad7d7 */
            display: flex;
            flex-direction: column; /* Para que el nav se apile sobre el main-container */
            align-items: center;
            justify-content: flex-start; /* Alinea el contenido al inicio de la columna */
            min-height: 100vh;
            padding: 1rem;
        }

        /* Estilos para el contenedor principal de la aplicación */
        .main-container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1), 0 5px 10px rgba(0,0,0,0.05);
            max-width: 750px; /* Ancho máximo para el diseño de dos columnas en desktop */
            width: 100%;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: 1fr; /* Una sola columna para las secciones principales */
            gap: 2.5rem; /* Espacio entre las secciones */
            margin-top: 2rem; /* Espacio para el nav bar */
        }

        /* Estilos para las tarjetas de sección (ej. el generador de citas) */
        .section-card {
            background-color: #b9d7ec; /* Fondo del formulario: celeste pastel */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border: 1px solid #e0f2fe;
            width: 100%;
        }

        /* Estilos para los inputs de texto, fecha, URL, número y selectores */
        input[type="text"],
        input[type="date"],
        input[type="url"],
        input[type="number"],
        select,
        textarea {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.03);
            width: 100%; /* Asegura que tomen el 100% del ancho de su contenedor */
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="url"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
            outline: none;
        }

        /* Estilos para los botones */
        button {
            font-weight: 600;
            padding: 0.85rem 1.5rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%; /* Asegura que los botones ocupen todo el ancho */
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        .generate-btn { /* Renombrado de #generateCitationBtn a .generate-btn */
            background: linear-gradient(to right, #3b82f6, #2563eb); /* Degradado azul */
            color: white;
        }
        .generate-btn:hover {
            background: linear-gradient(to right, #2563eb, #1d4ed8);
        }
        .copy-btn {
            background: linear-gradient(to right, #10b981, #059669); /* Degradado verde */
            color: white;
        }
        .copy-btn:hover {
            background: linear-gradient(to right, #059669, #047857);
        }

        /* Estilos para el área de texto de la cita generada */
        .reference-output-box {
            white-space: pre-wrap; /* Mantiene los saltos de línea y espacios */
            word-wrap: break-word; /* Rompe palabras largas para evitar desbordamiento (compatibilidad antigua) */
            overflow-wrap: break-word; /* Rompe palabras largas para evitar desbordamiento (moderno) */
            word-break: break-all; /* FUERZA la ruptura de palabras muy largas (como URLs) */
            user-select: all; /* Permite seleccionar todo el texto fácilmente */
            min-height: 100px; /* Altura mínima para visibilidad */
            text-align: left; /* Alinea el texto a la izquierda para APA */
            display: block; /* Asegura que se comporte como un elemento de bloque */
            padding-left: 1.5em; /* Sangría francesa: empuja todo el bloque hacia la derecha */
            text-indent: -1.5em; /* Sangría francesa: jala la primera línea hacia la izquierda */
            font-size: 0.95rem;
            line-height: 1.5;
            color: #374151;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            padding-top: 1rem; /* Añadido padding para el contenido de la cita */
            padding-right: 1rem; /* Añadido padding para el contenido de la cita */
            padding-bottom: 1rem; /* Añadido padding para el contenido de la cita */
            margin-top: 1rem; /* Añadido margen superior para separar del botón */
        }

        /* Mensajes de alerta */
        #messageBox {
            font-weight: 500;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            text-align: center;
            display: none; /* Oculto por defecto */
        }
        .text-red-600 { color: #dc2626; }
        .bg-red-100 { background-color: #fee2e2; }
        .text-green-600 { color: #10b981; }
        .bg-green-100 { background-color: #d1fae5; }
        .text-blue-600 { color: #2563eb; }
        .bg-blue-100 { background-color: #dbeafe; }
        .text-yellow-800 { color: #92400e; } /* Darker text for yellow background */
        .bg-yellow-100 { background-color: #fef3c7; } /* Light yellow for warning */

        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }

        /* Estilos para el menú de navegación */
        .navbar {
            width: 100%;
            max-width: 750px; /* Mismo ancho máximo que el main-container */
            background-color: #5d6470; /* Color oscuro para el nav */
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center; /* Centra los elementos del nav */
            gap: 2rem; /* Espacio entre los enlaces */
            margin-bottom: 1rem; /* Espacio entre el nav y el main-container */
        }
        .navbar a {
            color: #e5e9f0; /* Texto claro para los enlaces */
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
        }
        .navbar a:hover {
            background-color: #626e80; /* Fondo ligeramente más claro al pasar el ratón */
            color: #ffffff;
        }
        .navbar .active {
            background-color: #308ee6; /* Color azul para el enlace activo */
            color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Responsividad para pantallas pequeñas */
        @media (max-width: 768px) {
            .main-container {
                padding: 1.5rem;
                border-radius: 1rem;
                gap: 1.5rem;
                margin-top: 1rem;
            }
            h1 {
                font-size: 2rem;
            }
            p {
                font-size: 0.9rem;
            }
            .section-card {
                padding: 1.5rem;
            }
            /* Asegura que los desplegables se apilen en móviles */
            .document-type-selectors {
                flex-direction: column;
                gap: 1rem;
            }
            .navbar {
                flex-direction: column; /* Apila los enlaces en pantallas pequeñas */
                gap: 0.5rem;
                padding: 0.75rem 1rem;
            }
            .navbar a {
                text-align: center;
            }
        }

        /* Ajustes específicos para alinear los desplegables */
        .document-type-selectors {
            display: flex;
            flex-wrap: wrap; /* Permite que los elementos se envuelvan a la siguiente línea */
            gap: 1rem; /* Espacio entre los elementos */
            justify-content: space-between; /* Distribuye el espacio entre los elementos */
        }

        .document-type-selectors > div {
            flex: 1 1 calc(50% - 0.5rem); /* Dos columnas en desktop, con espacio */
            min-width: 200px; /* Ancho mínimo para cada columna antes de envolver */
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Alinea el contenido (label y select) a la parte inferior */
            height: auto; /* Permite que la altura se ajuste al contenido */
        }

        .document-type-selectors label {
            margin-bottom: 0.5rem; /* Espacio entre la etiqueta y el select */
            display: block;
            font-size: 0.875rem; /* Pequeña reducción para asegurar que quepan las etiquetas largas */
        }

        .document-type-selectors select {
            height: 3rem; /* Mantiene esta altura fija para alineación */
            font-size: 0.9rem; /* Pequeña reducción de fuente para el texto del select */
        }
    </style>
</head>
<body>
    <!-- Barra de Navegación -->
    <nav class="navbar">
        <a href="index.html" class="nav-link active" id="navReferencias">Citas de Referencia</a>
        <a href="citas directas.html" class="nav-link" id="navDirectas">Citas Directas</a>
    </nav>

    <div class="main-container">
        <!-- Nueva sección de cabecera con logo, título y enlace -->
        <div class="flex items-center justify-between flex-wrap p-4 bg-white rounded-lg shadow-md">
            <!-- Contenedor del Logo -->
            <div class="flex-shrink-0 mr-4">
                <!-- URL del logo proporcionada por el usuario -->
                <img src="logo.png" 
                     alt="Logo de Esto Es Historia" 
                     class="w-12 h-12 rounded-full"
                     onerror="this.onerror=null; this.src='https://placehold.co/48x48/CCCCCC/000000?text=Logo';">
            </div>
            
            <!-- Título "Esto Es Historia" con color HEX #780707 y fuente Playfair Display -->
            <h1 class="text-3xl font-extrabold tracking-tight flex-grow text-center md:text-left" style="color: #780707; font-family: 'Playfair Display', serif;">
                Esto Es Historia
            </h1>
            
            <!-- Enlace a la web -->
            <div class="flex-shrink-0 ml-4">
                <a href="https://www.facebook.com/TodoEstoEsHistoria" target="_blank" class="text-blue-600 hover:text-blue-800 font-semibold transition-colors duration-200">
                    Visita nuestra web
                </a>
            </div>
        </div>

        <!-- Sección del Generador de Citas APA Universal -->
        <div class="section-card">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Generador de Citas APA Universal</h1>
            <p class="text-gray-600 text-center mb-8">Introduce los detalles del documento para generar la cita en formato APA <br>(7ª edición).</p>

            <!-- Contenedor para los dos desplegables de tipo de documento -->
            <div class="document-type-selectors mb-4">
                <div>
                    <label for="documentTypeFormal" class="block text-gray-700 text-sm font-semibold">Fuentes Impresas / Formales:</label>
                    <select id="documentTypeFormal" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Selecciona...</option>
                        <option value="book">Libro</option>
                        <option value="bookChapter">Capítulo de Libro</option>
                        <option value="journalArticle">Publicación o Artículo de Revista</option>
                        <option value="newspaperArticlePrint">Artículo de Periódico (Impreso)</option>
                        <option value="thesis">Tesis o Disertación</option>
                        <option value="report">Informe</option>
                    </select>
                </div>
                <div>
                    <label for="documentTypeDigital" class="block text-gray-700 text-sm font-semibold">Fuentes Digitales / Otros:</label>
                    <select id="documentTypeDigital" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Selecciona...</option>
                        <option value="website">Página Web</option>
                        <option value="video">Video (YouTube, etc.)</option>
                        <option value="socialMedia">Publicación de Red Social</option>
                        <option value="dictionaryEntry">Entrada de Diccionario/Enciclopedia Online</option>
                        <option value="newspaperArticleOnline">Artículo de Periódico (Online)</option>
                        <option value="blogPost">Entrada de Blog</option>
                        <option value="software">Software</option>
                        <option value="dataSet">Conjunto de Datos</option>
                        <option value="interview">Entrevista (Comunicación Personal)</option>
                    </select>
                </div>
            </div>

            <!-- Campo de autor común (oculto por defecto, visible para tipos que lo usan) -->
            <div id="commonFields" class="space-y-4 hidden">
                <div>
                    <label for="authorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales. (separa con punto y coma para múltiples autores):</label>
                    <input type="text" id="authorName" placeholder="Ej: García, M. o García Manuel; Pérez, J.">
                </div>
            </div>

            <!-- Campos específicos para Página Web -->
            <div id="websiteFields" class="space-y-4 hidden">
                <div>
                    <label for="publicationDateWebsite" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (completa, si disponible) (Opcional):</label>
                    <input type="date" id="publicationDateWebsite">
                </div>
                <div>
                    <label for="articleTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Artículo / Documento:</label>
                    <input type="text" id="articleTitle" placeholder="Ej: ¿Qué es civilización? Parte 1 - Civilización y cultura">
                </div>
                <div>
                    <label for="websiteName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Sitio Web:</label>
                    <input type="text" id="websiteName" placeholder="Ej: Esto Es Historia">
                </div>
                <div>
                    <label for="urlWebsite" class="block text-gray-700 text-sm font-semibold mb-2">URL:</label>
                    <input type="url" id="urlWebsite" placeholder="Ej: https://www.ejemplo.com/articulo">
                </div>
            </div>

            <!-- Campos específicos para Libro -->
            <div id="bookFields" class="space-y-4 hidden">
                <div>
                    <label for="authorNameBook" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) del Libro (si aplica) - Apellido, Iniciales. (separa con punto y coma):</label>
                    <input type="text" id="authorNameBook" placeholder="Ej: Borges, J. L. o Borges Jorge Luis">
                </div>
                <div>
                    <label for="editorBook" class="block text-gray-700 text-sm font-semibold mb-2">Editor(es) del Libro (si aplica) - Apellido, Iniciales. (separa con punto y coma):</label>
                    <input type="text" id="editorBook" placeholder="Ej: García, J. o García Juan; Pérez, M.">
                </div>
                <!-- Nuevo campo para indicar si es una recopilación de un editor -->
                <div class="flex items-center mt-2">
                    <input type="checkbox" id="isCompilationBook" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                    <label for="isCompilationBook" class="ml-2 block text-gray-700 text-sm font-semibold">¿Es una recopilación de un editor (sin autor general)?</label>
                </div>
                <div>
                    <label for="translatorNameBook" class="block text-gray-700 text-sm font-semibold mb-2">Traductor(es) (si aplica) - Apellido, Iniciales. (separa con punto y coma):</label>
                    <input type="text" id="translatorNameBook" placeholder="Ej: Sánchez, A.">
                </div>
                <div>
                    <label for="publicationYearBook" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación de esta edición:</label>
                    <input type="number" id="publicationYearBook" placeholder="Ej: 2023">
                </div>
                <div>
                    <label for="originalPublicationYearBook" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación Original (si aplica) (Opcional):</label>
                    <input type="number" id="originalPublicationYearBook" placeholder="Ej: 1883">
                </div>
                <div>
                    <label for="bookTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Libro:</label>
                    <input type="text" id="bookTitle" placeholder="Ej: El nombre de la rosa">
                </div>
                <div>
                    <label for="publisherBook" class="block text-gray-700 text-sm font-semibold mb-2">Editorial:</label>
                    <input type="text" id="publisherBook" placeholder="Ej: Lumen">
                </div>
                <div>
                    <label for="doiBook" class="block text-gray-700 text-sm font-semibold mb-2">DOI (si aplica) (Opcional):</label>
                    <input type="text" id="doiBook" placeholder="Ej: 10.1037/0000165-000">
                </div>
            </div>

            <!-- Campos específicos para Capítulo de Libro -->
            <div id="bookChapterFields" class="space-y-4 hidden">
                <div>
                    <label for="chapterAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) del Capítulo - Apellido, Iniciales.:</label>
                    <input type="text" id="chapterAuthor" placeholder="Ej: Eco, U.">
                </div>
                <div>
                    <label for="chapterYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación del Capítulo:</label>
                    <input type="number" id="chapterYear" placeholder="Ej: 2023">
                </div>
                <div>
                    <label for="chapterTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Capítulo:</label>
                    <input type="text" id="chapterTitle" placeholder="Ej: La función del signo en la novela">
                </div>
                <div>
                    <label for="editorName" class="block text-gray-700 text-sm font-semibold mb-2">Editor(es) del Libro - Iniciales. Apellido (separa con punto y coma) (Opcional):</label>
                    <input type="text" id="editorName" placeholder="Ej: M. García; J. Pérez">
                </div>
                <div>
                    <label for="bookTitleChapter" class="block text-gray-700 text-sm font-semibold mb-2">Título del Libro:</label>
                    <input type="text" id="bookTitleChapter" placeholder="Ej: Ensayos sobre semiótica">
                </div>
                <div>
                    <label for="pagesChapter" class="block text-gray-700 text-sm font-semibold mb-2">Páginas del Capítulo (Ej: 15-30) (Opcional):</label>
                    <input type="text" id="pagesChapter" placeholder="Ej: 15-30">
                </div>
                <div>
                    <label for="publisherChapter" class="block text-gray-700 text-sm font-semibold mb-2">Editorial:</label>
                    <input type="text" id="publisherChapter" placeholder="Ej: Paidós">
                </div>
                <div>
                    <label for="doiChapter" class="block text-gray-700 text-sm font-semibold mb-2">DOI (si aplica) (Opcional):</label>
                    <input type="text" id="doiChapter" placeholder="Ej: 10.1037/0000165-000">
                </div>
            </div>

            <!-- Campos específicos para Artículo de Revista -->
            <div id="journalArticleFields" class="space-y-4 hidden">
                <div>
                    <label for="journalAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales.:</label>
                    <input type="text" id="journalAuthor" placeholder="Ej: Smith, J.; Doe, A.">
                </div>
                <div>
                    <label for="journalYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="journalYear" placeholder="Ej: 2023">
                </div>
                <div>
                    <label for="journalArticleTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Artículo:</label>
                    <input type="text" id="journalArticleTitle" placeholder="Ej: Impacto de la tecnología en la educación">
                </div>
                <div>
                    <label for="journalName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre de la Revista:</label>
                    <input type="text" id="journalName" placeholder="Ej: Revista de Psicología Aplicada">
                </div>
                <div>
                    <label for="journalVolume" class="block text-gray-700 text-sm font-semibold mb-2">Volumen (Opcional):</label>
                    <input type="text" id="journalVolume" placeholder="Ej: 15">
                </div>
                <div>
                    <label for="journalIssue" class="block text-gray-700 text-sm font-semibold mb-2">Número (si aplica) (Opcional):</label>
                    <input type="text" id="journalIssue" placeholder="Ej: 3">
                </div>
                <div>
                    <label for="journalPages" class="block text-gray-700 text-sm font-semibold mb-2">Páginas (Ej: 120-135) (Opcional):</label>
                    <input type="text" id="journalPages" placeholder="Ej: 120-135">
                </div>
                <div>
                    <label for="journalDoi" class="block text-gray-700 text-sm font-semibold mb-2">DOI (si aplica) (Opcional):</label>
                    <input type="text" id="journalDoi" placeholder="Ej: 10.1037/a0034916">
                </div>
            </div>

            <!-- Campos específicos para Artículo de Periódico (Impreso) -->
            <div id="newspaperArticlePrintFields" class="space-y-4 hidden">
                <div>
                    <label for="newspaperAuthorPrint" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales. (si disponible) (Opcional):</label>
                    <input type="text" id="newspaperAuthorPrint" placeholder="Ej: López, A.">
                </div>
                <div>
                    <label for="newspaperDatePrint" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (Año, Día Mes):</label>
                    <input type="date" id="newspaperDatePrint">
                </div>
                <div>
                    <label for="newspaperArticleTitlePrint" class="block text-gray-700 text-sm font-semibold mb-2">Título del Artículo:</label>
                    <input type="text" id="newspaperArticleTitlePrint" placeholder="Ej: El futuro de la inteligencia artificial">
                </div>
                <div>
                    <label for="newspaperNamePrint" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Periódico:</label>
                    <input type="text" id="newspaperNamePrint" placeholder="Ej: La Nación">
                </div>
                <div>
                    <label for="newspaperPagesPrint" class="block text-gray-700 text-sm font-semibold mb-2">Páginas (si aplica, Ej: A1, A4-A5) (Opcional):</label>
                    <input type="text" id="newspaperPagesPrint" placeholder="Ej: A1, A4-A5">
                </div>
            </div>

            <!-- Campos específicos para Tesis o Disertación -->
            <div id="thesisFields" class="space-y-4 hidden">
                <div>
                    <label for="thesisAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales.:</label>
                    <input type="text" id="thesisAuthor" placeholder="Ej: Rodríguez, L.">
                </div>
                <div>
                    <label for="thesisYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="thesisYear" placeholder="Ej: 2022">
                </div>
                <div>
                    <label for="thesisTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título de la Tesis/Disertación:</label>
                    <input type="text" id="thesisTitle" placeholder="Ej: Análisis de la resiliencia en adolescentes">
                </div>
                <div>
                    <label for="thesisType" class="block text-gray-700 text-sm font-semibold mb-2">Tipo de Tesis (Ej: Tesis doctoral inédita, Disertación):</label>
                    <input type="text" id="thesisType" placeholder="Ej: Tesis doctoral inédita">
                </div>
                <div>
                    <label for="thesisUniversity" class="block text-gray-700 text-sm font-semibold mb-2">Nombre de la Universidad:</label>
                    <input type="text" id="thesisUniversity" placeholder="Ej: Universidad de Buenos Aires">
                </div>
                <div>
                    <label for="thesisDatabase" class="block text-gray-700 text-sm font-semibold mb-2">Base de Datos (Ej: ProQuest Dissertations & Theses Global) (Opcional):</label>
                    <input type="text" id="thesisDatabase" placeholder="Ej: ProQuest Dissertations & Theses Global">
                </div>
                <div>
                    <label for="thesisUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL (si aplica) (Opcional):</label>
                    <input type="url" id="thesisUrl" placeholder="Ej: https://www.ejemplo.com/tesis">
                </div>
            </div>

            <!-- Campos específicos para Informe -->
            <div id="reportFields" class="space-y-4 hidden">
                <div>
                    <label for="reportAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales. / Nombre de Grupo:</label>
                    <input type="text" id="reportAuthor" placeholder="Ej: Organización Mundial de la Salud; Smith, J.">
                </div>
                <div>
                    <label for="reportYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="reportYear" placeholder="Ej: 2023">
                </div>
                <div>
                    <label for="reportTitle" class="block text-700 text-sm font-semibold mb-2">Título del Informe:</label>
                    <input type="text" id="reportTitle" placeholder="Ej: Informe anual sobre la salud global">
                </div>
                <div>
                    <label for="reportNumber" class="block text-gray-700 text-sm font-semibold mb-2">Número de Informe (si aplica) (Opcional):</label>
                    <input type="text" id="reportNumber" placeholder="Ej: No. 123">
                </div>
                <div>
                    <label for="reportPublisher" class="block text-gray-700 text-sm font-semibold mb-2">Editorial / Organización:</label>
                    <input type="text" id="reportPublisher" placeholder="Ej: Naciones Unidas">
                </div>
                <div>
                    <label for="reportUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL (si aplica) (Opcional):</label>
                    <input type="url" id="reportUrl" placeholder="Ej: https://www.ejemplo.com/informe">
                </div>
            </div>

            <!-- Campos específicos para Video -->
            <div id="videoFields" class="space-y-4 hidden">
                <div>
                    <label for="videoAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor / Canal (Ej: TED; National Geographic) (Opcional):</label>
                    <input type="text" id="videoAuthor" placeholder="Ej: TED; National Geographic">
                </div>
                <div>
                    <label for="videoDate" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (Año, Día Mes):</label>
                    <input type="date" id="videoDate">
                </div>
                <div>
                    <label for="videoTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Video:</label>
                    <input type="text" id="videoTitle" placeholder="Ej: Por qué deberías hacer cosas inútiles">
                </div>
                <div>
                    <label for="videoPlatform" class="block text-gray-700 text-sm font-semibold mb-2">Plataforma (Ej: YouTube, Vimeo):</label>
                    <input type="text" id="videoPlatform" placeholder="Ej: YouTube">
                </div>
                <div>
                    <label for="videoUrl" class="block text-700 text-sm font-semibold mb-2">URL:</label>
                    <input type="url" id="videoUrl" placeholder="Ej: https://www.youtube.com/watch?v=ejemplo">
                </div>
            </div>

            <!-- Campos específicos para Publicación de Red Social -->
            <div id="socialMediaFields" class="space-y-4 hidden">
                <div>
                    <label for="socialMediaAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor / Nombre de Usuario (Ej: @APA_Style; American Psychological Association):</label>
                    <input type="text" id="socialMediaAuthor" placeholder="Ej: @APA_Style; American Psychological Association">
                </div>
                <div>
                    <label for="socialMediaDate" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (Año, Día Mes):</label>
                    <input type="date" id="socialMediaDate">
                </div>
                <div>
                    <label for="socialMediaContent" class="block text-gray-700 text-sm font-semibold mb-2">Contenido de la Publicación (primeras 20 palabras):</label>
                    <input type="text" id="socialMediaContent" placeholder="Ej: ¡Nuevo manual APA ya disponible!">
                </div>
                <div>
                    <label for="socialMediaType" class="block text-gray-700 text-sm font-semibold mb-2">Tipo de Publicación (Ej: [Tweet], [Actualización de estado de Facebook], [Imagen de Instagram]):</label>
                    <input type="text" id="socialMediaType" placeholder="Ej: [Tweet]">
                </div>
                <div>
                    <label for="socialMediaPlatform" class="block text-gray-700 text-sm font-semibold mb-2">Plataforma (Ej: Twitter, Facebook, Instagram):</label>
                    <input type="text" id="socialMediaPlatform" placeholder="Ej: Twitter">
                </div>
                <div>
                    <label for="socialMediaUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL:</label>
                    <input type="url" id="socialMediaUrl" placeholder="Ej: https://twitter.com/ejemplo">
                </div>
            </div>

            <!-- Campos específicos para Entrada de Diccionario/Enciclopedia Online -->
            <div id="dictionaryEntryFields" class="space-y-4 hidden">
                <div>
                    <label for="dictAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor (si aplica, Ej: American Psychological Association; Merriam-Webster) (Opcional):</label>
                    <input type="text" id="dictAuthor" placeholder="Ej: American Psychological Association">
                </div>
                <div>
                    <label for="dictEntryTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título de la Entrada:</label>
                    <input type="text" id="dictEntryTitle" placeholder="Ej: Empatía">
                </div>
                <div>
                    <label for="dictName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Diccionario/Enciclopedia:</label>
                    <input type="text" id="dictName" placeholder="Ej: APA Dictionary of Psychology">
                </div>
                <div>
                    <label for="dictUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL:</label>
                    <input type="url" id="dictUrl" placeholder="Ej: https://dictionary.apa.org/empatia">
                </div>
            </div>

            <!-- Campos específicos para Artículo de Periódico (Online) -->
            <div id="newspaperArticleOnlineFields" class="space-y-4 hidden">
                <div>
                    <label for="newspaperAuthorOnline" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales. (si disponible) (Opcional):</label>
                    <input type="text" id="newspaperAuthorOnline" placeholder="Ej: López, A.">
                </div>
                <div>
                    <label for="newspaperDateOnline" class="block text-700 text-sm font-semibold mb-2">Fecha de Publicación (Año, Día Mes):</label>
                    <input type="date" id="newspaperDateOnline">
                </div>
                <div>
                    <label for="newspaperArticleTitleOnline" class="block text-gray-700 text-sm font-semibold mb-2">Título del Artículo:</label>
                    <input type="text" id="newspaperArticleTitleOnline" placeholder="Ej: El futuro de la inteligencia artificial">
                </div>
                <div>
                    <label for="newspaperNameOnline" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Periódico:</label>
                    <input type="text" id="newspaperNameOnline" placeholder="Ej: La Nación">
                </div>
                <div>
                    <label for="newspaperUrlOnline" class="block text-gray-700 text-sm font-semibold mb-2">URL:</label>
                    <input type="url" id="newspaperUrlOnline" placeholder="Ej: https://www.lanacion.com.ar/nota">
                </div>
            </div>

            <!-- Campos específicos para Entrada de Blog -->
            <div id="blogPostFields" class="space-y-4 hidden">
                <div>
                    <label for="blogAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales. / Nombre de Usuario (Opcional):</label>
                    <input type="text" id="blogAuthor" placeholder="Ej: Smith, J.; Psicología al Día">
                </div>
                <div>
                    <label for="blogDate" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (Año, Día Mes):</label>
                    <input type="date" id="blogDate">
                </div>
                <div>
                    <label for="blogPostTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título de la Entrada del Blog:</label>
                    <input type="text" id="blogPostTitle" placeholder="Ej: 5 consejos para mejorar tu productividad">
                </div>
                <div>
                    <label for="blogName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Blog:</label>
                    <input type="text" id="blogName" placeholder="Ej: El Blog de Psicología">
                </div>
                <div>
                    <label for="blogUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL:</label>
                    <input type="url" id="blogUrl" placeholder="Ej: https://www.psicologiaaldia.com/blog/post">
                </div>
            </div>

            <!-- Campos específicos para Software -->
            <div id="softwareFields" class="space-y-4 hidden">
                <div>
                    <label for="softwareAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor / Desarrollador (Ej: Microsoft; IBM Corp.):</label>
                    <input type="text" id="softwareAuthor" placeholder="Ej: Microsoft">
                </div>
                <div>
                    <label for="softwareYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación/Versión:</label>
                    <input type="number" id="softwareYear" placeholder="Ej: 2023">
                </div>
                <div>
                    <label for="softwareTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Software:</label>
                    <input type="text" id="softwareTitle" placeholder="Ej: SPSS Statistics">
                </div>
                <div>
                    <label for="softwareVersion" class="block text-gray-700 text-sm font-semibold mb-2">Versión (Ej: 25.0) (Opcional):</label>
                    <input type="text" id="softwareVersion" placeholder="Ej: 25.0">
                </div>
                <div>
                    <label for="softwarePublisher" class="block text-gray-700 text-sm font-semibold mb-2">Editorial / Distribuidor:</label>
                    <input type="text" id="softwarePublisher" placeholder="Ej: IBM Corp.">
                </div>
                <div>
                    <label for="softwareUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL (si aplica) (Opcional):</label>
                    <input type="url" id="softwareUrl" placeholder="Ej: https://www.ibm.com/spss">
                </div>
            </div>

            <!-- Campos específicos para Conjunto de Datos -->
            <div id="dataSetFields" class="space-y-4 hidden">
                <div>
                    <label for="dataSetAuthor" class="block text-gray-700 text-sm font-semibold mb-2">Autor / Creador (Ej: Pew Research Center):</label>
                    <input type="text" id="dataSetAuthor" placeholder="Ej: Pew Research Center">
                </div>
                <div>
                    <label for="dataSetYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación/Colección (Ej: 2018; 2015-2019):</label>
                    <input type="text" id="dataSetYear" placeholder="Ej: 2018 o 2015-2019">
                </div>
                <div>
                    <label for="dataSetTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Conjunto de Datos:</label>
                    <input type="text" id="dataSetTitle" placeholder="Ej: American Trends Panel Wave 26">
                </div>
                <div>
                    <label for="dataSetVersion" class="block text-gray-700 text-sm font-semibold mb-2">Versión (si aplica, Ej: V1) (Opcional):</label>
                    <input type="text" id="dataSetVersion" placeholder="Ej: V1">
                </div>
                <div>
                    <label for="dataSetPublisher" class="block text-gray-700 text-sm font-semibold mb-2">Editorial / Archivo (Ej: ICPSR):</label>
                    <input type="text" id="dataSetPublisher" placeholder="Ej: ICPSR">
                </div>
                <div>
                    <label for="dataSetUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL (si aplica) (Opcional):</label>
                    <input type="url" id="dataSetUrl" placeholder="Ej: https://www.ejemplo.com/dataset">
                </div>
            </div>

            <!-- Campos específicos para Entrevista (Comunicación Personal) -->
            <div id="interviewFields" class="space-y-4 hidden">
                <div>
                    <label for="intervieweeName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Entrevistado (Apellido, Iniciales.):</label>
                    <input type="text" id="intervieweeName" placeholder="Ej: Smith, J.">
                </div>
                <div>
                    <label for="interviewDate" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de la Entrevista (Año, Día Mes):</label>
                    <input type="date" id="interviewDate">
                </div>
                <div>
                    <label for="interviewTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título/Descripción de la Entrevista (opcional) (Opcional):</label>
                    <input type="text" id="interviewTitle" placeholder="Ej: Entrevista personal sobre experiencia laboral">
                </div>
                <div>
                    <label for="interviewMedium" class="block text-gray-700 text-sm font-semibold mb-2">Medio (Ej: Comunicación personal; Grabación de audio):</label>
                    <input type="text" id="interviewMedium" placeholder="Ej: Comunicación personal">
                </div>
                <div>
                    <label for="interviewSource" class="block text-gray-700 text-sm font-semibold mb-2">Fuente (Ej: Universidad de X; Colección privada):</label>
                    <input type="text" id="interviewSource" placeholder="Ej: Universidad de X">
                </div>
            </div>


            <button id="generateCitationBtn" class="generate-btn mt-6 w-full py-3">Generar Cita</button>

            <!-- Área de visualización de la cita -->
            <div class="mt-8 p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-inner">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Cita Generada:</h3>
                <p id="citationOutput" class="reference-output-box text-gray-700 italic">La cita aparecerá aquí.</p>
                <button id="copyCitationBtn" class="copy-btn mt-4 w-full py-2 hidden">Copiar Cita</button>
                <div id="messageBox" class="mt-4"></div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos del DOM
            const documentTypeFormalSelect = document.getElementById('documentTypeFormal');
            const documentTypeDigitalSelect = document.getElementById('documentTypeDigital');
            const commonFieldsDiv = document.getElementById('commonFields');
            const websiteFieldsDiv = document.getElementById('websiteFields');
            const bookFieldsDiv = document.getElementById('bookFields');
            const bookChapterFieldsDiv = document.getElementById('bookChapterFields');
            const journalArticleFieldsDiv = document.getElementById('journalArticleFields');
            const newspaperArticlePrintFieldsDiv = document.getElementById('newspaperArticlePrintFields');
            const thesisFieldsDiv = document.getElementById('thesisFields');
            const reportFieldsDiv = document.getElementById('reportFields');
            const videoFieldsDiv = document.getElementById('videoFields');
            const socialMediaFieldsDiv = document.getElementById('socialMediaFields');
            const dictionaryEntryFieldsDiv = document.getElementById('dictionaryEntryFields');
            const newspaperArticleOnlineFieldsDiv = document.getElementById('newspaperArticleOnlineFields');
            const blogPostFieldsDiv = document.getElementById('blogPostFields');
            const softwareFieldsDiv = document.getElementById('softwareFields');
            const dataSetFieldsDiv = document.getElementById('dataSetFields');
            const interviewFieldsDiv = document.getElementById('interviewFields');

            const generateCitationBtn = document.getElementById('generateCitationBtn');
            const citationOutput = document.getElementById('citationOutput');
            const copyCitationBtn = document.getElementById('copyCitationBtn');
            const messageBox = document.getElementById('messageBox');

            // Mapeo de tipos de documento a sus campos correspondientes
            const fieldVisibilityMap = {
                'website': [websiteFieldsDiv, commonFieldsDiv],
                'book': [bookFieldsDiv], 
                'bookChapter': [bookChapterFieldsDiv], 
                'journalArticle': [journalArticleFieldsDiv], 
                'newspaperArticlePrint': [newspaperArticlePrintFieldsDiv, commonFieldsDiv], 
                'thesis': [thesisFieldsDiv], 
                'report': [reportFieldsDiv], 
                'video': [videoFieldsDiv], 
                'socialMedia': [socialMediaFieldsDiv], 
                'dictionaryEntry': [dictionaryEntryFieldsDiv], 
                'newspaperArticleOnline': [newspaperArticleOnlineFieldsDiv, commonFieldsDiv], 
                'blogPost': [blogPostFieldsDiv], 
                'software': [softwareFieldsDiv], 
                'dataSet': [dataSetFieldsDiv], 
                'interview': [interviewFieldsDiv], 
            };

            // Función para mostrar mensajes
            function showMessage(message, type = 'info') {
                messageBox.textContent = message;
                messageBox.className = 'mt-4 p-3 rounded-md text-sm text-center'; // Reset classes
                if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-800');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-800');
                } else if (type === 'info') {
                    messageBox.classList.add('bg-blue-100', 'text-blue-800');
                } else if (type === 'warning') { // New warning type
                    messageBox.classList.add('bg-yellow-100', 'text-yellow-800');
                }
                messageBox.style.display = 'block';

                if (messageBox.timeoutId) {
                    clearTimeout(messageBox.timeoutId);
                }
                messageBox.timeoutId = setTimeout(() => {
                    messageBox.style.display = 'none';
                    messageBox.timeoutId = null;
                }, 7000); // Increased timeout for warnings/info messages
            }

            // Función para capitalizar la primera letra de cada palabra (título de la fuente)
            function toTitleCase(str) {
                if (!str) return '';
                return str.replace(/\w\S*/g, function(txt) {
                    return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
                });
            }

            // Función para capitalizar solo la primera letra de la primera palabra (título de la obra)
            // y mantener la capitalización de nombres propios.
            function toSentenceCase(str) {
                if (!str) return '';

                const words = str.trim().split(/\s+/);
                const formattedWords = [];
                let capitalizeNextWord = true; // Indicador para capitalizar la siguiente palabra (inicio del título o después de dos puntos/punto/etc.)

                for (let i = 0; i < words.length; i++) {
                    let word = words[i];
                    if (word.length === 0) continue;

                    let processedWord = word;
                    let trailingPunctuation = '';
                    let triggersNewCapitalization = false;

                    // Separar la puntuación final
                    const punctuationMatch = processedWord.match(/([.,:;?!])$/);
                    if (punctuationMatch) {
                        trailingPunctuation = punctuationMatch[1];
                        processedWord = processedWord.slice(0, -trailingPunctuation.length);
                        if (/[.:?!]/.test(trailingPunctuation)) {
                            triggersNewCapitalization = true;
                        }
                    }

                    // Aplicar reglas de capitalización
                    if (capitalizeNextWord) {
                        // Siempre capitalizar la primera letra de la primera palabra o después de un signo de puntuación que termina una oración/dos puntos
                        processedWord = processedWord.charAt(0).toUpperCase() + processedWord.slice(1).toLowerCase();
                        capitalizeNextWord = false; // Reiniciar para las palabras subsiguientes
                    } else {
                        // Para las palabras subsiguientes:
                        // Si la palabra ya está capitalizada (ej. "Juan"), mantenerla tal cual (se asume nombre propio).
                        // De lo contrario, convertir a minúsculas.
                        if (processedWord.charAt(0) === processedWord.charAt(0).toUpperCase() && processedWord.slice(1) === processedWord.slice(1).toLowerCase()) {
                            // Mantener tal cual (se asume nombre propio o intencionalmente capitalizado por el usuario)
                        } else {
                            processedWord = processedWord.toLowerCase(); // Convertir a minúsculas
                        }
                    }

                    formattedWords.push(processedWord + trailingPunctuation);
                    capitalizeNextWord = triggersNewCapitalization;
                }

                return formattedWords.join(' ');
            }

            // Función auxiliar para formatear un solo nombre de autor a "Apellido, I."
            // Esta versión busca preservar la capitalización del usuario para nombres propios
            // mientras asegura el formato APA (Apellido, Iniciales.).
            function formatSingleAuthor(nameString) {
                if (!nameString) return '';

                let cleanedName = nameString.trim();
                let lastName = '';
                let firstNames = [];

                // Caso 1: "Apellido, Nombre(s)" (formato de entrada preferido)
                if (cleanedName.includes(',')) {
                    const parts = cleanedName.split(',').map(p => p.trim());
                    lastName = parts[0];
                    firstNames = parts.slice(1).join(' ').trim().split(' ').filter(p => p.length > 0);
                }
                // Caso 2: "Nombre(s) Apellido" (si no hay coma, asumir esta estructura)
                else {
                    const nameParts = cleanedName.split(' ').filter(p => p.length > 0);
                    if (nameParts.length > 1) {
                        // Asumir que la primera palabra es un nombre y el resto es el apellido.
                        // Esta es una heurística que funciona mejor para apellidos compuestos como "De la Cruz".
                        firstNames = [nameParts[0]]; // La primera palabra es el nombre
                        lastName = nameParts.slice(1).join(' '); // El resto es el apellido
                    } else {
                        // Solo una palabra, asumir que es el apellido (sin nombre)
                        lastName = nameParts[0];
                        firstNames = [];
                    }
                }

                // Capitalizar la primera letra de cada parte del apellido (ej. "de la cruz" -> "De la Cruz")
                // Esto también preserva la capitalización del usuario si ingresó "De la Cruz" directamente.
                lastName = lastName.split(' ').map((word, index) => {
                    if (word.length === 0) return '';
                    // Manejo especial para partículas comunes en minúscula en nombres compuestos si no son la primera palabra del apellido
                    const lowercaseParticles = new Set(['de', 'del', 'la', 'las', 'los', 'y']);
                    if (lowercaseParticles.has(word.toLowerCase()) && index !== 0) {
                        return word.toLowerCase(); // Mantener las partículas en minúscula si no son la primera palabra del apellido
                    }
                    // FIX: Asegurar que el resto de la palabra esté en minúsculas para evitar mayúsculas completas como "GARCIA"
                    return word.charAt(0).toUpperCase() + word.slice(1).toLowerCase();
                }).join(' ');

                // Formatear iniciales (siempre en mayúscula y con un punto)
                let formattedInitials = firstNames.map(part => part.charAt(0).toUpperCase() + '.').join('');

                // Si hay iniciales, añadir una coma y un espacio antes de ellas
                if (formattedInitials) {
                    return `${lastName}, ${formattedInitials}`;
                } else {
                    return lastName; // Si no hay iniciales, solo devolver el apellido
                }
            }

            // Función para formatear autores (función principal)
            // Devuelve la cadena de autores formateada, asegurando un único punto al final.
            function formatAuthors(authorString, isEditor = false) {
                if (!authorString) return '';

                const rawAuthors = authorString.split(';').map(a => a.trim()).filter(a => a !== '');

                if (rawAuthors.length === 0) return '';

                let formattedIndividualAuthors = rawAuthors.map(author => formatSingleAuthor(author));

                if (isEditor) {
                    // Para editores, el estilo APA es (Inicial. Apellido) o (Inicial. Inicial. Apellido)
                    // Necesitamos reordenar de "Apellido, Iniciales." a "Iniciales. Apellido"
                    formattedIndividualAuthors = formattedIndividualAuthors.map(author => {
                        const parts = author.split(', '); // Divide "Apellido, Iniciales."
                        if (parts.length === 2 && parts[1].trim() !== '') { // Asegurarse de que haya iniciales
                            return `${parts[1]} ${parts[0]}`; // Reordenar a "Iniciales. Apellido"
                        }
                        return parts[0]; // Si solo es Apellido (ej. autor grupal), solo devolver el nombre
                    });
                }

                let finalAuthorString;
                const numAuthors = formattedIndividualAuthors.length;

                if (numAuthors === 1) {
                    finalAuthorString = formattedIndividualAuthors[0];
                } else if (numAuthors === 2) {
                    finalAuthorString = `${formattedIndividualAuthors[0]} & ${formattedIndividualAuthors[1]}`;
                } else if (numAuthors <= 20) { // APA 7ª ed. para 2-20 autores
                    let lastAuthor = formattedIndividualAuthors.pop();
                    finalAuthorString = `${formattedIndividualAuthors.join(', ')}, & ${lastAuthor}`;
                } else { // APA 7ª ed. para 21+ autores
                    const first19Authors = formattedIndividualAuthors.slice(0, 19).join(', ');
                    const lastAuthor = formattedIndividualAuthors[numAuthors - 1];
                    finalAuthorString = `${first19Authors}, ..., & ${lastAuthor}`;
                }

                // FIX: Asegurar que haya exactamente un punto al final del bloque de autores
                if (!finalAuthorString.endsWith('.')) {
                    finalAuthorString += '.';
                }
                return finalAuthorString;
            }

            // Función para capitalizar la primera letra de una frase
            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }

            // Función para formatear fechas de publicación
            function formatDate(dateInput) {
                if (!dateInput) return 'n.d.'; // Sin fecha
                const date = new Date(dateInput);
                const year = date.getFullYear();
                const month = date.toLocaleString('es-ES', { month: 'long' });
                const day = date.getDate();
                return `${year}, ${day} de ${month}`;
            }

            // Función para formatear la fecha de recuperación
            function getRetrievalDate() {
                const now = new Date();
                const day = now.getDate();
                const month = now.toLocaleString('es-ES', { month: 'long' });
                const year = now.getFullYear();
                return `${day} de ${month}, ${year}`;
            }

            // Función para ocultar todos los campos específicos
            function hideAllFields() {
                Object.values(fieldVisibilityMap).forEach(divs => {
                    divs.forEach(div => div.classList.add('hidden'));
                });
                commonFieldsDiv.classList.add('hidden'); // Asegura que los campos comunes también se oculten
            } // Removed the extra ')' here

            // Event listener para los selectores de tipo de documento
            documentTypeFormalSelect.addEventListener('change', (event) => {
                hideAllFields();
                documentTypeDigitalSelect.value = ''; // Resetea el otro selector
                const selectedType = event.target.value;
                if (fieldVisibilityMap[selectedType]) {
                    fieldVisibilityMap[selectedType].forEach(div => div.classList.remove('hidden'));
                }
                citationOutput.textContent = 'La cita aparecerá aquí.';
                copyCitationBtn.style.display = 'none';
            });

            documentTypeDigitalSelect.addEventListener('change', (event) => {
                hideAllFields();
                documentTypeFormalSelect.value = ''; // Resetea el otro selector
                const selectedType = event.target.value;
                if (fieldVisibilityMap[selectedType]) {
                    fieldVisibilityMap[selectedType].forEach(div => div.classList.remove('hidden'));
                }
                citationOutput.textContent = 'La cita aparecerá aquí.';
                copyCitationBtn.style.display = 'none';
            });

            // Event listener para el botón de generar cita
            generateCitationBtn.addEventListener('click', () => {
                let citation = '';
                let isValid = true;
                const selectedFormalType = documentTypeFormalSelect.value;
                const selectedDigitalType = documentTypeDigitalSelect.value;
                const docType = selectedFormalType || selectedDigitalType;

                // Función auxiliar para obtener valor de input y limpiar espacios
                const getValue = (id) => document.getElementById(id)?.value.trim();
                // Función auxiliar para obtener el estado de un checkbox
                const getChecked = (id) => document.getElementById(id)?.checked;

                switch (docType) {
                    case 'website':
                        const authorWebsite = getValue('authorName');
                        const dateWebsite = getValue('publicationDateWebsite');
                        const articleTitle = getValue('articleTitle');
                        const websiteName = getValue('websiteName');
                        const urlWebsite = getValue('urlWebsite');

                        // Validaciones
                        if (!articleTitle || !websiteName || !urlWebsite) {
                            showMessage('Por favor, completa los campos obligatorios para Página Web: Título del Artículo, Nombre del Sitio Web, URL.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedAuthorWebsite = formatAuthors(authorWebsite);
                        const authorPartWebsite = formattedAuthorWebsite ? `${formattedAuthorWebsite} ` : ''; 
                        const formattedDateWebsite = dateWebsite ? `(${new Date(dateWebsite).getFullYear()})` : '(n.d.)';
                        const retrievalDateWebsite = getRetrievalDate();

                        citation = `${authorPartWebsite}${formattedDateWebsite}. ${toSentenceCase(articleTitle)}. <i>${toTitleCase(websiteName)}</i>. Recuperado el ${retrievalDateWebsite}, de ${urlWebsite}`;
                        break;

                    case 'book':
                        const authorBook = getValue('authorNameBook'); 
                        const editorBook = getValue('editorBook');     
                        const isCompilationBookChecked = getChecked('isCompilationBook'); // Nuevo: checkbox
                        const translatorNameBook = getValue('translatorNameBook'); // Nuevo: traductor
                        const yearBook = getValue('publicationYearBook');
                        const originalPublicationYearBook = getValue('originalPublicationYearBook'); // Nuevo: año original
                        const bookTitle = getValue('bookTitle');
                        const publisherBook = getValue('publisherBook');
                        const doiBook = getValue('doiBook');

                        // Validaciones
                        if (!yearBook || !bookTitle || !publisherBook) {
                            showMessage('Por favor, completa los campos obligatorios para Libro: Año de Publicación, Título del Libro, Editorial.', 'error');
                            isValid = false;
                            break;
                        }

                        let mainContributorPart = '';
                        let translatorPart = '';
                        let originalYearPart = '';

                        // Lógica para el contribuyente principal (autor o editor)
                        if (isCompilationBookChecked) {
                            if (editorBook) {
                                mainContributorPart = `${formatAuthors(editorBook, true)} `;
                                if (authorBook) {
                                    showMessage('Advertencia: Ha marcado "Es una recopilación de un editor". Si el editor es el responsable principal de la compilación, el campo "Autor(es) del Libro" debería estar vacío. La cita se generará con el editor como autor principal.', 'warning');
                                }
                            } else {
                                showMessage('Error: Ha marcado "Es una recopilación de un editor" pero el campo "Editor(es) del Libro" está vacío. Por favor, ingrese el editor o desmarque la opción.', 'error');
                                isValid = false;
                                break;
                            }
                        } else { // No es una recopilación de un editor, prioriza el autor
                            if (authorBook) {
                                mainContributorPart = `${formatAuthors(authorBook)} `;
                                if (editorBook) {
                                    showMessage('Advertencia: Si el libro tiene un autor principal, el editor no se incluye en la referencia principal del libro según las normas APA. El campo "Editor(es) del Libro" será ignorado.', 'warning');
                                }
                            } else if (editorBook) {
                                // Si no hay autor pero hay editor y no es una compilación explícita, usar editor pero advertir
                                mainContributorPart = `${formatAuthors(editorBook, true)} `;
                                showMessage('Advertencia: No se ha especificado un autor principal. La cita se generará con el editor como contribuyente principal. Si es un libro con autor, por favor, rellene el campo "Autor(es) del Libro".', 'warning');
                            } else {
                                showMessage('Error: Por favor, completa el Autor(es) del Libro o el Editor(es) del Libro.', 'error');
                                isValid = false;
                                break;
                            }
                        }

                        // Formato del traductor
                        if (translatorNameBook) {
                            const rawTranslators = translatorNameBook.split(';').map(t => t.trim()).filter(t => t !== '');
                            let formattedTranslators = rawTranslators.map(translator => {
                                const parts = formatSingleAuthor(translator).split(', ');
                                if (parts.length === 2) {
                                    return `${parts[1]} ${parts[0]}`; // Formato "Inicial. Apellido"
                                }
                                return parts[0]; // Si solo hay apellido
                            }).join(', ');
                            const numTranslators = rawTranslators.length;
                            const translatorSuffix = numTranslators > 1 ? 'Trads.' : 'Trad.';
                            translatorPart = ` (${formattedTranslators}, ${translatorSuffix})`;
                        }

                        // Formato del año original
                        if (originalPublicationYearBook) {
                            originalYearPart = ` (Obra original publicada en ${originalPublicationYearBook})`;
                        }

                        let bookDoiPart = doiBook ? ` ${doiBook}` : '';

                        citation = `${mainContributorPart}(${yearBook}). <i>${toSentenceCase(bookTitle)}</i>${translatorPart}. ${toTitleCase(publisherBook)}.${bookDoiPart}${originalYearPart}`;
                        break;

                    case 'bookChapter':
                        const chapterAuthor = getValue('chapterAuthor');
                        const chapterYear = getValue('chapterYear');
                        const chapterTitle = getValue('chapterTitle');
                        const editorName = getValue('editorName');
                        const bookTitleChapter = getValue('bookTitleChapter');
                        const pagesChapter = getValue('pagesChapter');
                        const publisherChapter = getValue('publisherChapter');
                        const doiChapter = getValue('doiChapter');

                        // Validaciones
                        if (!chapterAuthor || !chapterYear || !chapterTitle || !bookTitleChapter || !publisherChapter) {
                            showMessage('Por favor, completa los campos obligatorios para Capítulo de Libro: Autor(es) del Capítulo, Año de Publicación del Capítulo, Título del Capítulo, Título del Libro, Editorial.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedChapterAuthor = formatAuthors(chapterAuthor);
                        const authorPartChapter = formattedChapterAuthor ? `${formattedChapterAuthor} ` : ''; 
                        const formattedEditorName = editorName ? formatAuthors(editorName, true) : ''; // Editor es opcional
                        // Asegurarse de que el sufijo (Ed.) o (Eds.) se añada correctamente si hay editor
                        const editorSuffixChapter = editorName && editorName.split(';').filter(e => e.trim() !== '').length > 1 ? '(Eds.)' : '(Ed.)';
                        const editorPartChapter = formattedEditorName ? `En ${formattedEditorName.replace(/\.$/, '')} ${editorSuffixChapter}, ` : ''; // Eliminar el punto final de formatAuthors para añadir el sufijo
                        const pagesPartChapter = pagesChapter ? `(pp. ${pagesChapter})` : '';
                        let chapterDoiPart = doiChapter ? ` ${doiChapter}` : '';

                        citation = `${authorPartChapter}(${chapterYear}). ${toSentenceCase(chapterTitle)}. ${editorPartChapter}<i>${toSentenceCase(bookTitleChapter)}</i> ${pagesPartChapter}. ${toTitleCase(publisherChapter)}.${chapterDoiPart}`;
                        break;

                    case 'journalArticle':
                        const journalAuthor = getValue('journalAuthor');
                        const journalYear = getValue('journalYear');
                        const journalArticleTitle = getValue('journalArticleTitle');
                        const journalName = getValue('journalName');
                        const journalVolume = getValue('journalVolume');
                        const journalIssue = getValue('journalIssue');
                        const journalPages = getValue('journalPages');
                        const journalDoi = getValue('journalDoi');

                        // Validaciones: Volumen ahora es opcional
                        if (!journalAuthor || !journalYear || !journalArticleTitle || !journalName) {
                            showMessage('Por favor, completa los campos obligatorios para Artículo de Revista: Autor(es), Año de Publicación, Título del Artículo, Nombre de la Revista.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedJournalAuthor = formatAuthors(journalAuthor);
                        const authorPartJournal = formattedJournalAuthor ? `${formattedJournalAuthor} ` : ''; 
                        const volumePart = journalVolume ? `<i>${journalVolume}</i>` : ''; // Volumen es opcional
                        const issuePart = journalIssue ? `(${journalIssue})` : '';
                        const pagesPartJournal = journalPages ? `, ${journalPages}` : ''; // Páginas es opcional
                        let journalDoiPart = journalDoi ? ` ${journalDoi}` : '';

                        // Construcción de la cita para Artículo de Revista, ajustando para volumen opcional
                        let journalInfo = '';
                        if (volumePart && issuePart) {
                            journalInfo = `${volumePart}${issuePart}`;
                        } else if (volumePart) {
                            journalInfo = volumePart;
                        } else if (issuePart) {
                             // Si solo hay número, APA 7th ed. dice que no se pone cursiva y se pone el número entre paréntesis
                            journalInfo = `(${journalIssue})`;
                        }

                        citation = `${authorPartJournal}(${journalYear}). ${toSentenceCase(journalArticleTitle)}. <i>${toTitleCase(journalName)}</i>, ${journalInfo}${pagesPartJournal}.${journalDoiPart}`;
                        break;

                    case 'newspaperArticlePrint':
                        const newspaperAuthorPrint = getValue('newspaperAuthorPrint');
                        const newspaperDatePrint = getValue('newspaperDatePrint');
                        const newspaperArticleTitlePrint = getValue('newspaperArticleTitlePrint');
                        const newspaperNamePrint = getValue('newspaperNamePrint');
                        const newspaperPagesPrint = getValue('newspaperPagesPrint');

                        // Validaciones
                        if (!newspaperDatePrint || !newspaperArticleTitlePrint || !newspaperNamePrint) {
                            showMessage('Por favor, completa los campos obligatorios para Artículo de Periódico (Impreso): Fecha de Publicación, Título del Artículo, Nombre del Periódico.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedNewspaperAuthorPrint = newspaperAuthorPrint ? formatAuthors(newspaperAuthorPrint) : '';
                        const authorPeriodPrint = formattedNewspaperAuthorPrint ? `${formattedNewspaperAuthorPrint} ` : ''; 
                        const dateObjPrint = new Date(newspaperDatePrint);
                        const formattedDatePrint = `(${dateObjPrint.getFullYear()}, ${dateObjPrint.toLocaleString('es-ES', { day: 'numeric', month: 'long' })})`;
                        const pagesPartPrint = newspaperPagesPrint ? `, pp. ${newspaperPagesPrint}` : '';

                        citation = `${authorPeriodPrint}${formattedDatePrint}. ${toSentenceCase(newspaperArticleTitlePrint)}. <i>${toTitleCase(newspaperNamePrint)}</i>${pagesPartPrint}.`;
                        break;

                    case 'thesis':
                        const thesisAuthor = getValue('thesisAuthor');
                        const thesisYear = getValue('thesisYear');
                        const thesisTitle = getValue('thesisTitle');
                        const thesisType = getValue('thesisType');
                        const thesisUniversity = getValue('thesisUniversity');
                        const thesisDatabase = getValue('thesisDatabase');
                        const thesisUrl = getValue('thesisUrl');

                        // Validaciones
                        if (!thesisAuthor || !thesisYear || !thesisTitle || !thesisType || !thesisUniversity) {
                            showMessage('Por favor, completa los campos obligatorios para Tesis o Disertación: Autor(es), Año de Publicación, Título de la Tesis/Disertación, Tipo de Tesis, Nombre de la Universidad.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedThesisAuthor = formatAuthors(thesisAuthor);
                        const authorPartThesis = formattedThesisAuthor ? `${formattedThesisAuthor} ` : ''; 
                        let thesisSource = `${toTitleCase(thesisUniversity)}.`;
                        if (thesisDatabase) {
                            thesisSource = `${toTitleCase(thesisDatabase)}.`;
                        }
                        if (thesisUrl) {
                            thesisSource += ` ${thesisUrl}`;
                        }

                        citation = `${authorPartThesis}(${thesisYear}). <i>${toSentenceCase(thesisTitle)}</i> [${capitalizeFirstLetter(thesisType)}]. ${thesisSource}`;
                        break;

                    case 'report':
                        const reportAuthor = getValue('reportAuthor');
                        const reportYear = getValue('reportYear');
                        const reportTitle = getValue('reportTitle');
                        const reportNumber = getValue('reportNumber');
                        const reportPublisher = getValue('reportPublisher');
                        const reportUrl = getValue('reportUrl');

                        // Validaciones
                        if (!reportAuthor || !reportYear || !reportTitle || !reportPublisher) {
                            showMessage('Por favor, completa los campos obligatorios para Informe: Autor(es), Año de Publicación, Título del Informe, Editorial / Organización.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedReportAuthor = formatAuthors(reportAuthor);
                        const authorPartReport = formattedReportAuthor ? `${formattedReportAuthor} ` : ''; 
                        const reportNumberPart = reportNumber ? ` (${reportNumber})` : '';
                        let reportPublisherPart = toTitleCase(reportPublisher); 
                        if (reportAuthor.toLowerCase() === reportPublisher.toLowerCase()) { 
                            reportPublisherPart = '';
                        } else {
                            reportPublisherPart = `${reportPublisherPart}.`;
                        }
                        let reportUrlPart = reportUrl ? ` ${reportUrl}` : '';

                        citation = `${authorPartReport}(${reportYear}). <i>${toSentenceCase(reportTitle)}</i>${reportNumberPart}. ${reportPublisherPart}${reportUrlPart}`;
                        break;

                    case 'video':
                        const videoAuthor = getValue('videoAuthor');
                        const videoDate = getValue('videoDate');
                        const videoTitle = getValue('videoTitle');
                        const videoPlatform = getValue('videoPlatform');
                        const videoUrl = getValue('videoUrl');

                        // Validaciones
                        if (!videoDate || !videoTitle || !videoPlatform || !videoUrl) {
                            showMessage('Por favor, completa los campos obligatorios para Video: Fecha de Publicación, Título del Video, Plataforma, URL.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedVideoAuthor = videoAuthor ? formatAuthors(videoAuthor) : '';
                        const authorPartVideo = formattedVideoAuthor ? `${formattedVideoAuthor} ` : ''; 
                        const dateObjVideo = new Date(videoDate);
                        const formattedDateVideo = `(${dateObjVideo.getFullYear()}, ${dateObjVideo.toLocaleString('es-ES', { month: 'long', day: 'numeric' })})`;

                        citation = `${authorPartVideo}${formattedDateVideo}. <i>${toSentenceCase(videoTitle)}</i> [Video]. ${toTitleCase(videoPlatform)}. ${videoUrl}`;
                        break;

                    case 'socialMedia':
                        const socialMediaAuthor = getValue('socialMediaAuthor');
                        const socialMediaDate = getValue('socialMediaDate');
                        const socialMediaContent = getValue('socialMediaContent');
                        const socialMediaType = getValue('socialMediaType');
                        const socialMediaPlatform = getValue('socialMediaPlatform');
                        const socialMediaUrl = getValue('socialMediaUrl');

                        // Validaciones
                        if (!socialMediaAuthor || !socialMediaDate || !socialMediaContent || !socialMediaType || !socialMediaPlatform || !socialMediaUrl) {
                            showMessage('Por favor, completa todos los campos obligatorios para Publicación de Red Social: Autor / Nombre de Usuario, Fecha de Publicación, Contenido de la Publicación, Tipo de Publicación, Plataforma, URL.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedSocialMediaAuthor = socialMediaAuthor.startsWith('@') ? socialMediaAuthor : formatAuthors(socialMediaAuthor);
                        const authorPartSocialMedia = formattedSocialMediaAuthor ? `${formattedSocialMediaAuthor} ` : ''; 
                        const dateObjSocialMedia = new Date(socialMediaDate);
                        const formattedDateSocialMedia = `(${dateObjSocialMedia.getFullYear()}, ${dateObjSocialMedia.toLocaleString('es-ES', { month: 'long', day: 'numeric' })})`;

                        citation = `${authorPartSocialMedia}${formattedDateSocialMedia}. <i>${toSentenceCase(socialMediaContent)}</i> ${socialMediaType}. ${toTitleCase(socialMediaPlatform)}. ${socialMediaUrl}`;
                        break;

                    case 'dictionaryEntry':
                        const dictAuthor = getValue('dictAuthor');
                        const dictEntryTitle = getValue('dictEntryTitle');
                        const dictName = getValue('dictName');
                        const dictUrl = getValue('dictUrl');

                        // Validaciones
                        if (!dictEntryTitle || !dictName || !dictUrl) {
                            showMessage('Por favor, completa los campos obligatorios para Entrada de Diccionario/Enciclopedia Online: Título de la Entrada, Nombre del Diccionario/Enciclopedia, URL.', 'error');
                            isValid = false;
                            break;
                        }

                        const dictAuthorPart = dictAuthor ? `${formatAuthors(dictAuthor)} ` : ''; 
                        const retrievalDateDict = getRetrievalDate();

                        citation = `${dictAuthorPart}${toSentenceCase(dictEntryTitle)}. (n.d.). En <i>${toTitleCase(dictName)}</i>. Recuperado el ${retrievalDateDict}, de ${dictUrl}`;
                        break;

                    case 'newspaperArticleOnline':
                        const newspaperAuthorOnline = getValue('newspaperAuthorOnline');
                        const newspaperDateOnline = getValue('newspaperDateOnline');
                        const newspaperArticleTitleOnline = getValue('newspaperArticleTitleOnline');
                        const newspaperNameOnline = getValue('newspaperNameOnline');
                        const newspaperUrlOnline = getValue('newspaperUrlOnline');

                        // Validaciones
                        if (!newspaperDateOnline || !newspaperArticleTitleOnline || !newspaperNameOnline || !newspaperUrlOnline) {
                            showMessage('Por favor, completa los campos obligatorios para Artículo de Periódico (Online): Fecha de Publicación, Título del Artículo, Nombre del Periódico, URL.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedNewspaperAuthorOnline = newspaperAuthorOnline ? formatAuthors(newspaperAuthorOnline) : '';
                        const authorPartOnline = formattedNewspaperAuthorOnline ? `${formattedNewspaperAuthorOnline} ` : ''; 
                        const dateObjOnline = new Date(newspaperDateOnline);
                        const formattedDateOnline = `(${dateObjOnline.getFullYear()}, ${dateObjOnline.toLocaleString('es-ES', { day: 'numeric', month: 'long' })})`;

                        citation = `${authorPartOnline}${formattedDateOnline}. ${toSentenceCase(newspaperArticleTitleOnline)}. <i>${toTitleCase(newspaperNameOnline)}</i>. ${newspaperUrlOnline}`;
                        break;

                    case 'blogPost':
                        const blogAuthor = getValue('blogAuthor');
                        const blogDate = getValue('blogDate');
                        const blogPostTitle = getValue('blogPostTitle');
                        const blogName = getValue('blogName');
                        const blogUrl = getValue('blogUrl');

                        // Validaciones
                        if (!blogDate || !blogPostTitle || !blogName || !blogUrl) {
                            showMessage('Por favor, completa los campos obligatorios para Entrada de Blog: Fecha de Publicación, Título de la Entrada del Blog, Nombre del Blog, URL.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedBlogAuthor = blogAuthor ? formatAuthors(blogAuthor) : '';
                        const authorPartBlog = formattedBlogAuthor ? `${formattedBlogAuthor} ` : ''; 
                        const dateObjBlog = new Date(blogDate);
                        const formattedDateBlog = `(${dateObjBlog.getFullYear()}, ${dateObjBlog.toLocaleString('es-ES', { day: 'numeric', month: 'long' })})`;

                        citation = `${authorPartBlog}${formattedDateBlog}. ${toSentenceCase(blogPostTitle)}. <i>${toTitleCase(blogName)}</i>. ${blogUrl}`;
                        break;

                    case 'software':
                        const softwareAuthor = getValue('softwareAuthor');
                        const softwareYear = getValue('softwareYear');
                        const softwareTitle = getValue('softwareTitle');
                        const softwareVersion = getValue('softwareVersion');
                        const softwarePublisher = getValue('softwarePublisher');
                        const softwareUrl = getValue('softwareUrl');

                        // Validaciones
                        if (!softwareAuthor || !softwareYear || !softwareTitle || !softwarePublisher) {
                            showMessage('Por favor, completa los campos obligatorios para Software: Autor / Desarrollador, Año de Publicación/Versión, Título del Software, Editorial / Distribuidor.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedSoftwareAuthor = formatAuthors(softwareAuthor);
                        const authorPartSoftware = formattedSoftwareAuthor ? `${formattedSoftwareAuthor} ` : ''; 
                        const softwareVersionPart = softwareVersion ? ` (Version ${softwareVersion})` : '';
                        let softwarePublisherPart = toTitleCase(softwarePublisher); 
                        if (softwareAuthor.toLowerCase() === softwarePublisher.toLowerCase()) { 
                            softwarePublisherPart = '';
                        } else {
                            softwarePublisherPart = `${softwarePublisherPart}.`;
                        }
                        let softwareUrlPart = softwareUrl ? ` ${softwareUrl}` : '';

                        citation = `${authorPartSoftware}(${softwareYear}). <i>${toSentenceCase(softwareTitle)}</i>${softwareVersionPart} [Computer software]. ${softwarePublisherPart}${softwareUrlPart}`;
                        break;

                    case 'dataSet':
                        const dataSetAuthor = getValue('dataSetAuthor');
                        const dataSetYear = getValue('dataSetYear');
                        const dataSetTitle = getValue('dataSetTitle');
                        const dataSetVersion = getValue('dataSetVersion');
                        const dataSetPublisher = getValue('dataSetPublisher');
                        const dataSetUrl = getValue('dataSetUrl');

                        // Validaciones
                        if (!dataSetAuthor || !dataSetYear || !dataSetTitle || !dataSetPublisher) {
                            showMessage('Por favor, completa los campos obligatorios para Conjunto de Datos: Autor / Creador, Año de Publicación/Colección, Título del Conjunto de Datos, Editorial / Archivo.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedDataSetAuthor = formatAuthors(dataSetAuthor);
                        const authorPartDataSet = formattedDataSetAuthor ? `${formattedDataSetAuthor} ` : ''; 
                        const dataSetVersionPart = dataSetVersion ? ` (Version ${dataSetVersion})` : '';
                        let dataSetPublisherPart = toTitleCase(dataSetPublisher); 
                        if (dataSetAuthor.toLowerCase() === dataSetPublisher.toLowerCase()) { 
                            dataSetPublisherPart = '';
                        } else {
                            dataSetPublisherPart = `${dataSetPublisherPart}.`;
                        }
                        let dataSetUrlPart = dataSetUrl ? ` ${dataSetUrl}` : '';

                        citation = `${authorPartDataSet}(${dataSetYear}). <i>${toSentenceCase(dataSetTitle)}</i>${dataSetVersionPart} [Conjunto de datos]. ${dataSetPublisherPart}${dataSetUrlPart}`;
                        break;

                    case 'interview':
                        const intervieweeName = getValue('intervieweeName');
                        const interviewDate = getValue('interviewDate');
                        const interviewTitle = getValue('interviewTitle');
                        const interviewMedium = getValue('interviewMedium');
                        const interviewSource = getValue('interviewSource');

                        // Validaciones
                        if (!intervieweeName || !interviewDate || !interviewMedium || !interviewSource) {
                            showMessage('Por favor, completa los campos obligatorios para Entrevista: Nombre del Entrevistado, Fecha de la Entrevista, Medio, Fuente.', 'error');
                            isValid = false;
                            break;
                        }

                        const formattedIntervieweeName = formatAuthors(intervieweeName); 
                        const authorPartInterview = formattedIntervieweeName ? `${formattedIntervieweeName} ` : ''; 
                        const dateObjInterview = new Date(interviewDate);
                        const formattedInterviewDate = `(${dateObjInterview.getFullYear()}, ${dateObjInterview.toLocaleString('es-ES', { day: 'numeric', month: 'long' })})`;
                        
                        let interviewTitlePart = interviewTitle ? `<i>${toSentenceCase(interviewTitle)}</i>` : '';
                        
                        const titleSuffix = interviewTitlePart.endsWith('.') ? '' : '.';
                        
                        if (interviewMedium.toLowerCase() === 'comunicación personal') {
                            citation = `${authorPartInterview}${formattedInterviewDate}. ${interviewTitlePart} [Comunicación personal].`;
                        } else {
                            citation = `${authorPartInterview}${formattedInterviewDate}. ${interviewTitlePart}${titleSuffix} [${capitalizeFirstLetter(interviewMedium)}]. ${toTitleCase(interviewSource)}.`; 
                        }
                        break;

                    default:
                        showMessage('Selecciona un tipo de documento para generar la cita.', 'error');
                        isValid = false;
                        break;
                }

                if (!isValid) {
                    citationOutput.textContent = 'La cita aparecerá aquí.';
                    copyCitationBtn.style.display = 'none';
                    return;
                }

                citationOutput.innerHTML = citation;
                copyCitationBtn.style.display = 'block';
                showMessage('Cita generada con éxito.', 'success');
            });

            // Event listener para el botón de copiar cita
            copyCitationBtn.addEventListener('click', () => {
                const citationText = citationOutput.innerText;
                const textArea = document.createElement('textarea');
                textArea.value = citationText;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showMessage('Cita copiada al portapapeles.', 'success');
                } catch (err) {
                    showMessage('Error al copiar la cita. Por favor, cópiala manualmente.', 'error');
                }
                document.body.removeChild(textArea);
            });
        });
    </script>
</body>
</html>
