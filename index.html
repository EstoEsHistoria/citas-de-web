<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Citas APA Universal</title>
    <!-- Metadato de autor para esta página -->
    <meta name="author" content="Esto Es Historia">
    <!-- Metadato de año de creación para esta página -->
    <meta name="creation_year" content="2025">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter (para el cuerpo) y Playfair Display (para el título principal) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap" rel="stylesheet">
    <style>
        /* Estilos generales del cuerpo */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #dad7d7; /* Color de fondo de la página: HEX #dad7d7 */
            display: flex;
            flex-direction: column; /* Para que el nav se apile sobre el main-container */
            align-items: center;
            justify-content: flex-start; /* Alinea el contenido al inicio de la columna */
            min-height: 100vh;
            padding: 1rem;
        }

        /* Estilos para el contenedor principal de la aplicación */
        .main-container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1), 0 5px 10px rgba(0,0,0,0.05);
            max-width: 750px; /* Ancho máximo para el diseño de dos columnas en desktop */
            width: 100%;
            box-sizing: border-box;
            display: grid;
            grid-template-columns: 1fr; /* Una sola columna para las secciones principales */
            gap: 2.5rem; /* Espacio entre las secciones */
            margin-top: 2rem; /* Espacio para el nav bar */
        }

        /* Estilos para las tarjetas de sección (ej. el generador de citas) */
        .section-card {
            background-color: #b9d7ec; /* Fondo del formulario: celeste pastel */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            border: 1px solid #e0f2fe;
            width: 100%;
        }

        /* Estilos para los inputs de texto, fecha, URL, número y selectores */
        input[type="text"],
        input[type="date"],
        input[type="url"],
        input[type="number"],
        select,
        textarea {
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.03);
            width: 100%; /* Asegura que tomen el 100% del ancho de su contenedor */
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="url"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
            outline: none;
        }

        /* Estilos para los botones */
        button {
            font-weight: 600;
            padding: 0.85rem 1.5rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 100%; /* Asegura que los botones ocupen todo el ancho */
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0,0,0,0.15);
        }
        .generate-btn { /* Renombrado de #generateCitationBtn a .generate-btn */
            background: linear-gradient(to right, #3b82f6, #2563eb); /* Degradado azul */
            color: white;
        }
        .generate-btn:hover {
            background: linear-gradient(to right, #2563eb, #1d4ed8);
        }
        .copy-btn {
            background: linear-gradient(to right, #10b981, #059669); /* Degradado verde */
            color: white;
        }
        .copy-btn:hover {
            background: linear-gradient(to right, #059669, #047857);
        }

        /* Estilos para el área de texto de la cita generada */
        .reference-output-box {
            white-space: pre-wrap; /* Mantiene los saltos de línea y espacios */
            word-wrap: break-word; /* Rompe palabras largas para evitar desbordamiento (compatibilidad antigua) */
            overflow-wrap: break-word; /* Rompe palabras largas para evitar desbordamiento (moderno) */
            word-break: break-all; /* FUERZA la ruptura de palabras muy largas (como URLs) */
            user-select: all; /* Permite seleccionar todo el texto fácilmente */
            min-height: 100px; /* Altura mínima para visibilidad */
            text-align: left; /* Alinea el texto a la izquierda para APA */
            display: block; /* Asegura que se comporte como un elemento de bloque */
            padding-left: 1.5em; /* Sangría francesa: empuja todo el bloque hacia la derecha */
            text-indent: -1.5em; /* Sangría francesa: jala la primera línea hacia la izquierda */
            font-size: 0.95rem;
            line-height: 1.5;
            color: #374151;
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
            padding-top: 1rem; /* Añadido padding para el contenido de la cita */
            padding-right: 1rem; /* Añadido padding para el contenido de la cita */
            padding-bottom: 1rem; /* Añadido padding para el contenido de la cita */
            margin-top: 1rem; /* Añadido margen superior para separar del botón */
        }

        /* Mensajes de alerta */
        #messageBox {
            font-weight: 500;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            text-align: center;
            display: none; /* Oculto por defecto */
        }
        .text-red-600 { color: #dc2626; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }

        /* Estilos para el menú de navegación */
        .navbar {
            width: 100%;
            max-width: 750px; /* Mismo ancho máximo que el main-container */
            background-color: #5d6470; /* Color oscuro para el nav */
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center; /* Centra los elementos del nav */
            gap: 2rem; /* Espacio entre los enlaces */
            margin-bottom: 1rem; /* Espacio entre el nav y el main-container */
        }
        .navbar a {
            color: #e5e9f0; /* Texto claro para los enlaces */
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
        }
        .navbar a:hover {
            background-color: #626e80; /* Fondo ligeramente más claro al pasar el ratón */
            color: #ffffff;
        }
        .navbar .active {
            background-color: #308ee6; /* Color azul para el enlace activo */
            color: #ffffff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Responsividad para pantallas pequeñas */
        @media (max-width: 768px) {
            .main-container {
                padding: 1.5rem;
                border-radius: 1rem;
                gap: 1.5rem;
                margin-top: 1rem;
            }
            h1 {
                font-size: 2rem;
            }
            p {
                font-size: 0.9rem;
            }
            .section-card {
                padding: 1.5rem;
            }
            /* Asegura que los desplegables se apilen en móviles */
            .document-type-selectors {
                flex-direction: column;
                gap: 1rem;
            }
            .navbar {
                flex-direction: column; /* Apila los enlaces en pantallas pequeñas */
                gap: 0.5rem;
                padding: 0.75rem 1rem;
            }
            .navbar a {
                text-align: center;
            }
        }

        /* Ajustes específicos para alinear los desplegables */
        .document-type-selectors {
            display: flex;
            flex-wrap: wrap; /* Permite que los elementos se envuelvan a la siguiente línea */
            gap: 1rem; /* Espacio entre los elementos */
            justify-content: space-between; /* Distribuye el espacio entre los elementos */
        }

        .document-type-selectors > div {
            flex: 1 1 calc(50% - 0.5rem); /* Dos columnas en desktop, con espacio */
            min-width: 200px; /* Ancho mínimo para cada columna antes de envolver */
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* Alinea el contenido (label y select) a la parte inferior */
            height: auto; /* Permite que la altura se ajuste al contenido */
        }

        .document-type-selectors label {
            margin-bottom: 0.5rem; /* Espacio entre la etiqueta y el select */
            display: block;
            font-size: 0.875rem; /* Pequeña reducción para asegurar que quepan las etiquetas largas */
        }

        .document-type-selectors select {
            height: 3rem; /* Mantiene esta altura fija para alineación */
            font-size: 0.9rem; /* Pequeña reducción de fuente para el texto del select */
        }
    </style>
</head>
<body>
    <!-- Barra de Navegación -->
    <nav class="navbar">
        <a href="index.html" class="nav-link active" id="navReferencias">Citas de Referencia</a>
        <a href="citas directas.html" class="nav-link" id="navDirectas">Citas Directas</a>
    </nav>

    <div class="main-container">
        <!-- Nueva sección de cabecera con logo, título y enlace -->
        <div class="flex items-center justify-between flex-wrap p-4 bg-white rounded-lg shadow-md">
            <!-- Contenedor del Logo -->
            <div class="flex-shrink-0 mr-4">
                <!-- URL del logo proporcionada por el usuario -->
                <img src="logo.png" 
                     alt="Logo de Esto Es Historia" 
                     class="w-12 h-12 rounded-full"
                     onerror="this.onerror=null; this.src='https://placehold.co/48x48/CCCCCC/000000?text=Logo';">
            </div>
            
            <!-- Título "Esto Es Historia" con color HEX #780707 y fuente Playfair Display -->
            <h1 class="text-3xl font-extrabold tracking-tight flex-grow text-center md:text-left" style="color: #780707; font-family: 'Playfair Display', serif;">
                Esto Es Historia
            </h1>
            
            <!-- Enlace a la web -->
            <div class="flex-shrink-0 ml-4">
                <a href="https://www.facebook.com/TodoEstoEsHistoria" target="_blank" class="text-blue-600 hover:text-blue-800 font-semibold transition-colors duration-200">
                    Visita nuestra web
                </a>
            </div>
        </div>

        <!-- Sección del Generador de Citas APA Universal -->
        <div class="section-card">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Generador de Citas APA Universal</h1>
            <p class="text-gray-600 text-center mb-8">Introduce los detalles del documento para generar la cita en formato APA <br>(7ª edición).</p>

            <!-- Contenedor para los dos desplegables de tipo de documento -->
            <div class="document-type-selectors mb-4">
                <div>
                    <label for="documentTypeFormal" class="block text-gray-700 text-sm font-semibold">Fuentes Impresas / Formales:</label>
                    <select id="documentTypeFormal" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Selecciona...</option>
                        <option value="book">Libro</option>
                        <option value="bookChapter">Capítulo de Libro</option>
                        <option value="journalArticle">Publicación o Artículo</option>
                        <option value="thesis">Tesis o Disertación</option>
                        <option value="report">Informe</option>
                    </select>
                </div>
                <div>
                    <label for="documentTypeDigital" class="block text-gray-700 text-sm font-semibold">Fuentes Digitales / Online:</label>
                    <select id="documentTypeDigital" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Selecciona...</option>
                        <option value="website">Página Web</option>
                        <option value="video">Video (YouTube, etc.)</option>
                        <option value="socialMedia">Publicación de Red Social</option>
                        <option value="dictionaryEntry">Entrada de Diccionario/Enciclopedia Online</option>
                    </select>
                </div>
            </div>

            <!-- Campo de autor común (oculto por defecto, visible para tipos que lo usan) -->
            <div id="commonFields" class="space-y-4 hidden">
                <div>
                    <label for="authorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales. (separa con punto y coma para múltiples autores):</label>
                    <input type="text" id="authorName" placeholder="Ej: García, M. o García Manuel; Pérez, J.">
                </div>
            </div>

            <!-- Campos específicos para Página Web -->
            <div id="websiteFields" class="space-y-4 hidden">
                <div>
                    <label for="publicationDateWebsite" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (completa, si disponible):</label>
                    <input type="date" id="publicationDateWebsite">
                </div>
                <div>
                    <label for="articleTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Artículo / Documento:</label>
                    <input type="text" id="articleTitle" placeholder="Ej: ¿Qué es civilización? Parte 1 - Civilización y cultura">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="websiteName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Sitio Web:</label>
                    <input type="text" id="websiteName" placeholder="Ej: Wikipedia, BBC News, Esto Es Historia">
                </div>
                <div>
                    <label for="pageUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL de la Página:</label>
                    <input type="url" id="pageUrl" placeholder="Ej: https://ejemplo.com/articulo">
                </div>
            </div>

            <!-- Campos específicos para Libro -->
            <div id="bookFields" class="space-y-4 hidden">
                <div>
                    <label for="publicationYearBook" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="publicationYearBook" placeholder="Ej: 2023 (obligatorio)">
                </div>
                <div>
                    <label for="bookTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Libro:</label>
                    <input type="text" id="bookTitle" placeholder="Ej: El Quijote de la Mancha">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="publisher" class="block text-gray-700 text-sm font-semibold mb-2">Editorial:</label>
                    <input type="text" id="publisher" placeholder="Ej: Penguin Random House">
                </div>
                <div>
                    <label for="isbn" class="block text-gray-700 text-sm font-semibold mb-2">ISBN (opcional):</label>
                    <input type="text" id="isbn" placeholder="Ej: 978-3-16-148410-0">
                </div>
            </div>

            <!-- Campos específicos para Publicación o Artículo -->
            <div id="journalArticleFields" class="space-y-4 hidden">
                <div>
                    <label for="publicationYearJournal" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="publicationYearJournal" placeholder="Ej: 2023 (obligatorio)">
                </div>
                <div>
                    <label for="journalArticleTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Artículo:</label>
                    <input type="text" id="journalArticleTitle" placeholder="Ej: El impacto de la IA en la sociedad moderna">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="journalName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre de la Publicación/Revista:</label>
                    <input type="text" id="journalName" placeholder="Ej: Nature, Communications Earth & Environment">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="journalVolume" class="block text-gray-700 text-sm font-semibold mb-2">Volumen (opcional):</label>
                        <input type="text" id="journalVolume" placeholder="Ej: 15">
                    </div>
                    <div>
                        <label for="journalIssue" class="block text-gray-700 text-sm font-semibold mb-2">Número (opcional):</label>
                        <input type="text" id="journalIssue" placeholder="Ej: 3">
                    </div>
                </div>
                <div>
                    <label for="pageRange" class="block text-gray-700 text-sm font-semibold mb-2">Rango de Páginas (opcional):</label>
                    <input type="text" id="pageRange" placeholder="Ej: 123-145">
                </div>
                <div>
                    <label for="doi" class="block text-gray-700 text-sm font-semibold mb-2">DOI (opcional):</label>
                    <input type="text" id="doi" placeholder="Ej: 10.1037/a0028240">
                </div>
            </div>

            <!-- Campos específicos para Capítulo de Libro -->
            <div id="bookChapterFields" class="space-y-4 hidden">
                <div>
                    <label for="chapterAuthorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) del Capítulo - Apellido, Iniciales.:</label>
                    <input type="text" id="chapterAuthorName" placeholder="Ej: Smith, J.">
                </div>
                <div>
                    <label for="chapterPublicationYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="chapterPublicationYear" placeholder="Ej: 2020">
                </div>
                <div>
                    <label for="chapterTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Capítulo:</label>
                    <input type="text" id="chapterTitle" placeholder="Ej: La evolución de la escritura">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="bookEditorName" class="block text-gray-700 text-sm font-semibold mb-2">Editor(es) del Libro (Apellido, Iniciales.; separa con punto y coma):</label>
                    <input type="text" id="bookEditorName" placeholder="Ej: Jones, A.; Brown, B.">
                </div>
                <div>
                    <label for="bookTitleChapter" class="block text-gray-700 text-sm font-semibold mb-2">Título del Libro:</label>
                    <input type="text" id="bookTitleChapter" placeholder="Ej: Manual de historia antigua">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="chapterPageRange" class="block text-gray-700 text-sm font-semibold mb-2">Rango de Páginas del Capítulo (Ej: 123-145):</label>
                    <input type="text" id="chapterPageRange" placeholder="Ej: 50-75">
                </div>
                <div>
                    <label for="publisherChapter" class="block text-gray-700 text-sm font-semibold mb-2">Editorial:</label>
                    <input type="text" id="publisherChapter" placeholder="Ej: Editorial Universitaria">
                </div>
                <div>
                    <label for="doiChapter" class="block text-gray-700 text-sm font-semibold mb-2">DOI (opcional):</label>
                    <input type="text" id="doiChapter" placeholder="Ej: 10.xxxx/xxxx">
                </div>
            </div>

            <!-- Campos específicos para Tesis o Disertación -->
            <div id="thesisFields" class="space-y-4 hidden">
                <div>
                    <label for="thesisAuthorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) - Apellido, Iniciales.:</label>
                    <input type="text" id="thesisAuthorName" placeholder="Ej: Pérez, A.">
                </div>
                <div>
                    <label for="thesisPublicationYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="thesisPublicationYear" placeholder="Ej: 2022">
                </div>
                <div>
                    <label for="thesisTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título de la Tesis/Disertación:</label>
                    <input type="text" id="thesisTitle" placeholder="Ej: Impacto del cambio climático en la flora patagónica">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="thesisType" class="block text-gray-700 text-sm font-semibold mb-2">Tipo de Tesis:</label>
                    <select id="thesisType">
                        <option value="Tesis de maestría no publicada">Tesis de maestría no publicada</option>
                        <option value="Disertación doctoral no publicada">Disertación doctoral no publicada</option>
                        <option value="Tesis de maestría">Tesis de maestría (publicada)</option>
                        <option value="Disertación doctoral">Disertación doctoral (publicada)</option>
                    </select>
                </div>
                <div>
                    <label for="universityName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre de la Universidad:</label>
                    <input type="text" id="universityName" placeholder="Ej: Universidad Nacional de Cuyo">
                </div>
                <div>
                    <label for="thesisUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL (si es de un repositorio online):</label>
                    <input type="url" id="thesisUrl" placeholder="Ej: https://repositorio.uncuyo.edu.ar/tesis/123">
                </div>
            </div>

            <!-- Campos específicos para Informe -->
            <div id="reportFields" class="space-y-4 hidden">
                <div>
                    <label for="reportAuthorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) / Organización (Apellido, Iniciales. o Nombre Completo de la Organización):</label>
                    <input type="text" id="reportAuthorName" placeholder="Ej: Ministerio de Salud; Organización Mundial de la Salud">
                </div>
                <div>
                    <label for="reportPublicationYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación:</label>
                    <input type="number" id="reportPublicationYear" placeholder="Ej: 2024">
                </div>
                <div>
                    <label for="reportTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Informe:</label>
                    <input type="text" id="reportTitle" placeholder="Ej: Informe anual de desarrollo sostenible">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="reportNumber" class="block text-gray-700 text-sm font-semibold mb-2">Número de Informe (opcional):</label>
                    <input type="text" id="reportNumber" placeholder="Ej: No. 123">
                </div>
                <div>
                    <label for="reportPublisher" class="block text-gray-700 text-sm font-semibold mb-2">Editorial / Organización que lo publica (si es diferente al autor):</label>
                    <input type="text" id="reportPublisher" placeholder="Ej: Naciones Unidas">
                </div>
                <div>
                    <label for="reportUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL (si es online):</label>
                    <input type="url" id="reportUrl" placeholder="Ej: https://www.who.int/reports/123">
                </div>
            </div>

            <!-- Campos específicos para Video -->
            <div id="videoFields" class="space-y-4 hidden">
                <div>
                    <label for="videoAuthorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor / Canal (Nombre de usuario o Nombre del Canal):</label>
                    <input type="text" id="videoAuthorName" placeholder="Ej: National Geographic; Esto Es Historia">
                </div>
                <div>
                    <label for="videoPublicationDate" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (completa, si disponible):</label>
                    <input type="date" id="videoPublicationDate">
                </div>
                <div>
                    <label for="videoTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título del Video:</label>
                    <input type="text" id="videoTitle" placeholder="Ej: La historia del Imperio Romano en 5 minutos">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="videoPlatform" class="block text-gray-700 text-sm font-semibold mb-2">Plataforma:</label>
                    <input type="text" id="videoPlatform" placeholder="Ej: YouTube, Vimeo">
                </div>
                <div>
                    <label for="videoUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL del Video:</label>
                    <input type="url" id="videoUrl" placeholder="Ej: https://www.youtube.com/watch?v=abc123xyz">
                </div>
            </div>

            <!-- Campos específicos para Publicación de Red Social -->
            <div id="socialMediaFields" class="space-y-4 hidden">
                <div>
                    <label for="socialMediaAuthorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor (Nombre real, si conocido):</label>
                    <input type="text" id="socialMediaAuthorName" placeholder="Ej: Juan Pérez">
                </div>
                <div>
                    <label for="socialMediaUsername" class="block text-gray-700 text-sm font-semibold mb-2">Nombre de Usuario (@handle):</label>
                    <input type="text" id="socialMediaUsername" placeholder="Ej: @JuanPerezHistoria">
                </div>
                <div>
                    <label for="socialMediaPublicationDate" class="block text-gray-700 text-sm font-semibold mb-2">Fecha de Publicación (completa):</label>
                    <input type="date" id="socialMediaPublicationDate">
                </div>
                <div>
                    <label for="socialMediaContent" class="block text-gray-700 text-sm font-semibold mb-2">Contenido del Post (primeras 20 palabras):</label>
                    <textarea id="socialMediaContent" rows="3" placeholder="Ej: 'Hoy exploramos la fascinante historia de la civilización maya y sus grandes avances...'"></textarea>
                    <p class="text-gray-500 text-xs mt-1">El formato se ajustará automáticamente.</p>
                </div>
                <!-- Eliminado: Tipo de Publicación -->
                <div>
                    <label for="socialMediaPlatform" class="block text-gray-700 text-sm font-semibold mb-2">Plataforma:</label>
                    <input type="text" id="socialMediaPlatform" placeholder="Ej: X, Facebook, Instagram">
                </div>
                <div>
                    <label for="socialMediaUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL de la Publicación:</label>
                    <input type="url" id="socialMediaUrl" placeholder="Ej: https://x.com/user/status/12345">
                </div>
            </div>

            <!-- Campos específicos para Entrada de Diccionario/Enciclopedia Online -->
            <div id="dictionaryEntryFields" class="space-y-4 hidden">
                <div>
                    <label for="dictionaryAuthorName" class="block text-gray-700 text-sm font-semibold mb-2">Autor(es) (opcional, Apellido, Iniciales. o Nombre de la Organización):</label>
                    <input type="text" id="dictionaryAuthorName" placeholder="Ej: Merriam-Webster; Smith, J.">
                </div>
                <div>
                    <label for="dictionaryPublicationYear" class="block text-gray-700 text-sm font-semibold mb-2">Año de Publicación (opcional, o "s.f." si no hay fecha):</label>
                    <input type="text" id="dictionaryPublicationYear" placeholder="Ej: 2023 o s.f.">
                </div>
                <div>
                    <label for="dictionaryEntryTitle" class="block text-gray-700 text-sm font-semibold mb-2">Título de la Entrada:</label>
                    <input type="text" id="dictionaryEntryTitle" placeholder="Ej: Civilización">
                    <p class="text-gray-500 text-xs mt-1">Colocar nombres propios respetando mayúsculas y minúsculas.</p>
                </div>
                <div>
                    <label for="dictionaryName" class="block text-gray-700 text-sm font-semibold mb-2">Nombre del Diccionario/Enciclopedia:</label>
                    <input type="text" id="dictionaryName" placeholder="Ej: Wikipedia, Real Academia Española">
                </div>
                <div>
                    <label for="dictionaryUrl" class="block text-gray-700 text-sm font-semibold mb-2">URL de la Entrada:</label>
                    <input type="url" id="dictionaryUrl" placeholder="Ej: https://dle.rae.es/civilizacion">
                </div>
            </div>

            <!-- El desplegable de Comunicación Personal ha sido eliminado -->

            <!-- Botón para generar la cita -->
            <button id="generateCitationBtn" class="generate-btn mt-6">
                Generar Cita APA
            </button>
        </div>

        <!-- Sección de salida de la cita -->
        <div class="mt-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">Cita Generada:</h2>
            <div id="citationOutput" class="reference-output-box">
                La cita aparecerá aquí.
            </div>
            <button id="copyCitationBtn" class="copy-btn mt-4" style="display: none;">
                Copiar Cita
            </button>
            <div id="messageBox"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Referencias a los elementos del DOM
            const documentTypeFormalSelect = document.getElementById('documentTypeFormal');
            const documentTypeDigitalSelect = document.getElementById('documentTypeDigital');
            // documentTypeNonRecoverableSelect ha sido eliminado

            // Contenedores de campos específicos
            const commonFieldsDiv = document.getElementById('commonFields');
            const websiteFieldsDiv = document.getElementById('websiteFields');
            const bookFieldsDiv = document.getElementById('bookFields');
            const journalArticleFieldsDiv = document.getElementById('journalArticleFields');
            const bookChapterFieldsDiv = document.getElementById('bookChapterFields');
            const thesisFieldsDiv = document.getElementById('thesisFields');
            const reportFieldsDiv = document.getElementById('reportFields');
            const videoFieldsDiv = document.getElementById('videoFields');
            const socialMediaFieldsDiv = document.getElementById('socialMediaFields');
            const dictionaryEntryFieldsDiv = document.getElementById('dictionaryEntryFields');
            // personalCommunicationFieldsDiv ha sido eliminado

            // Inputs comunes y específicos
            const authorNameInput = document.getElementById('authorName');
            const publicationDateWebsiteInput = document.getElementById('publicationDateWebsite');
            const articleTitleInput = document.getElementById('articleTitle');
            const websiteNameInput = document.getElementById('websiteName');
            const pageUrlInput = document.getElementById('pageUrl');
            const publicationYearBookInput = document.getElementById('publicationYearBook');
            const bookTitleInput = document.getElementById('bookTitle');
            const publisherInput = document.getElementById('publisher');
            const isbnInput = document.getElementById('isbn');
            const publicationYearJournalInput = document.getElementById('publicationYearJournal');
            const journalArticleTitleInput = document.getElementById('journalArticleTitle');
            const journalNameInput = document.getElementById('journalName');
            const journalVolumeInput = document.getElementById('journalVolume');
            const journalIssueInput = document.getElementById('journalIssue');
            const pageRangeInput = document.getElementById('pageRange');
            const doiInput = document.getElementById('doi');
            const chapterAuthorNameInput = document.getElementById('chapterAuthorName');
            const chapterPublicationYearInput = document.getElementById('chapterPublicationYear');
            const chapterTitleInput = document.getElementById('chapterTitle');
            const bookEditorNameInput = document.getElementById('bookEditorName');
            const bookTitleChapterInput = document.getElementById('bookTitleChapter');
            const chapterPageRangeInput = document.getElementById('chapterPageRange');
            const publisherChapterInput = document.getElementById('publisherChapter');
            const doiChapterInput = document.getElementById('doiChapter');
            const thesisAuthorNameInput = document.getElementById('thesisAuthorName');
            const thesisPublicationYearInput = document.getElementById('thesisPublicationYear');
            const thesisTitleInput = document.getElementById('thesisTitle');
            const thesisTypeSelect = document.getElementById('thesisType');
            const universityNameInput = document.getElementById('universityName');
            const thesisUrlInput = document.getElementById('thesisUrl');
            const reportAuthorNameInput = document.getElementById('reportAuthorName');
            const reportPublicationYearInput = document.getElementById('reportPublicationYear');
            const reportTitleInput = document.getElementById('reportTitle');
            const reportNumberInput = document.getElementById('reportNumber');
            const reportPublisherInput = document.getElementById('reportPublisher');
            const reportUrlInput = document.getElementById('reportUrl');
            const videoAuthorNameInput = document.getElementById('videoAuthorName');
            const videoPublicationDateInput = document.getElementById('videoPublicationDate');
            const videoTitleInput = document.getElementById('videoTitle');
            const videoPlatformInput = document.getElementById('videoPlatform');
            const videoUrlInput = document.getElementById('videoUrl');
            const socialMediaAuthorNameInput = document.getElementById('socialMediaAuthorName');
            const socialMediaUsernameInput = document.getElementById('socialMediaUsername');
            const socialMediaPublicationDateInput = document.getElementById('socialMediaPublicationDate');
            const socialMediaContentInput = document.getElementById('socialMediaContent');
            // socialMediaTypeSelect ha sido eliminado
            const socialMediaPlatformInput = document.getElementById('socialMediaPlatform');
            const socialMediaUrlInput = document.getElementById('socialMediaUrl');
            const dictionaryAuthorNameInput = document.getElementById('dictionaryAuthorName');
            const dictionaryPublicationYearInput = document.getElementById('dictionaryPublicationYear');
            const dictionaryEntryTitleInput = document.getElementById('dictionaryEntryTitle');
            const dictionaryNameInput = document.getElementById('dictionaryName');
            const dictionaryUrlInput = document.getElementById('dictionaryUrl');
            // pcAuthorNameInput y pcDateInput han sido eliminados

            const generateCitationBtn = document.getElementById('generateCitationBtn');
            const citationOutput = document.getElementById('citationOutput');
            const copyCitationBtn = document.getElementById('copyCitationBtn');
            const messageBox = document.getElementById('messageBox');

            // Función para mostrar mensajes temporales al usuario
            function showMessage(message, type = 'info') {
                messageBox.textContent = message;
                messageBox.className = 'mt-4 p-3 rounded-md text-sm text-center'; // Resetear clases
                if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-800');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-800');
                } else { // info
                    messageBox.classList.add('bg-blue-100', 'text-blue-800');
                }
                messageBox.style.display = 'block';

                if (messageBox.timeoutId) {
                    clearTimeout(messageBox.timeoutId);
                }
                messageBox.timeoutId = setTimeout(() => {
                    messageBox.style.display = 'none';
                    messageBox.timeoutId = null;
                }, 3000);
            }

            // Función para formatear una cadena de fecha a "Año, Día de Mes" o "s.f."
            function formatDateForReference(dateString) {
                if (!dateString) return 's.f.';
                const date = new Date(dateString + 'T00:00:00');
                if (isNaN(date.getTime())) return 's.f.';

                const year = date.getFullYear();
                const month = date.toLocaleDateString('es-ES', { month: 'long' });
                const day = date.getDate();

                return `${year}, ${day} de ${month}`;
            }

            // Función para formatear un solo nombre de autor a "Apellido, I." o "Apellido"
            function formatSingleAuthor(nameString) {
                if (!nameString) return '';

                let cleanedName = nameString.trim();
                let lastName = '';
                let initialsParts = []; // To hold "J", "P"

                // Si contiene una coma, asumimos "Apellido, Nombre(s)"
                if (cleanedName.includes(',')) {
                    const parts = cleanedName.split(',');
                    lastName = parts[0].trim();
                    const firstNames = parts.slice(1).join(' ').trim();
                    initialsParts = firstNames.split(' ').filter(p => p.length > 0).map(part => part.charAt(0).toUpperCase());
                } else {
                    // Si no contiene coma, asumimos "Nombre(s) Apellido" o "Apellido"
                    const parts = cleanedName.split(' ').filter(p => p.length > 0);
                    if (parts.length > 1) {
                        lastName = parts[parts.length - 1].trim(); // Última palabra es el apellido
                        initialsParts = parts.slice(0, parts.length - 1).map(part => part.charAt(0).toUpperCase());
                    } else {
                        lastName = parts[0].trim(); // Si solo hay una palabra, es el apellido
                    }
                }
                
                // Asegurarse de que el apellido esté en minúsculas antes de capitalizar solo la primera letra
                lastName = lastName.charAt(0).toUpperCase() + lastName.slice(1).toLowerCase();

                let authorPart = lastName;
                if (initialsParts.length > 0) {
                    authorPart += `, ${initialsParts.join('.')}.`; // Add comma, initials joined by dot, and final dot
                }
                // No extra comma or dot if no initials.

                return authorPart;
            }

            // Función para formatear múltiples autores para la lista de referencias
            function formatAuthorsForReference(authorString) {
                if (!authorString) return '';

                const rawAuthors = authorString.split(';').map(a => a.trim()).filter(a => a !== '');
                const formattedIndividualAuthors = rawAuthors.map(name => formatSingleAuthor(name));
                const numAuthors = formattedIndividualAuthors.length;

                if (numAuthors === 0) {
                    return '';
                } else if (numAuthors === 1) {
                    return formattedIndividualAuthors[0];
                } else if (numAuthors <= 20) {
                    const lastAuthor = formattedIndividualAuthors.pop();
                    return formattedIndividualAuthors.join(', ') + ' & ' + lastAuthor;
                } else {
                    const first19Authors = formattedIndividualAuthors.slice(0, 19).join(', ');
                    const lastAuthor = formattedIndividualAuthors[numAuthors - 1];
                    return first19Authors + ', ...., & ' + lastAuthor;
                }
            }

            // Función para formatear el título en "Sentence case" (primera letra mayúscula, resto minúscula, excepto nombres propios y después de dos puntos)
            function formatTitleForSentenceCase(titleString) {
                if (!titleString) return '';

                const words = titleString.trim().split(/\s+/);
                const formattedWords = [];
                let capitalizeNextWord = true; // Flag to capitalize the next word (start of title or after colon/period/etc.)

                const minorWords = new Set([
                    'a', 'ante', 'bajo', 'cabe', 'con', 'contra', 'de', 'desde', 'durante', 'en', 'entre', 'hacia', 'hasta', 'mediante', 'para', 'por', 'según', 'sin', 'so', 'sobre', 'tras', 'versus', 'vía', // preposiciones
                    'y', 'e', 'ni', 'o', 'u', // conjunciones
                    'el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas', // artículos
                    'pero', 'mas', 'sino', 'aunque', 'porque', 'pues', 'si', 'cuando', 'como', 'donde', 'que' // other common conjunctions/adverbs
                ]);

                for (let i = 0; i < words.length; i++) {
                    let word = words[i];
                    if (word.length === 0) continue;

                    let processedWord = word;
                    let trailingPunctuation = '';
                    let triggersNewCapitalization = false;

                    // Separate trailing punctuation
                    const punctuationMatch = processedWord.match(/([.,:;?!])$/);
                    if (punctuationMatch) {
                        trailingPunctuation = punctuationMatch[1];
                        processedWord = processedWord.slice(0, -trailingPunctuation.length);
                        if (/[.:?!]/.test(trailingPunctuation)) {
                            triggersNewCapitalization = true;
                        }
                    }

                    // Apply capitalization rules
                    if (capitalizeNextWord) {
                        // Always capitalize the first letter of the first word or after a sentence-ending punctuation/colon
                        processedWord = processedWord.charAt(0).toUpperCase() + processedWord.slice(1).toLowerCase();
                        capitalizeNextWord = false; // Reset for subsequent words
                    } else if (minorWords.has(processedWord.toLowerCase())) {
                        // Minor words are always lowercase (unless they were the very first word of the title/subtitle)
                        processedWord = processedWord.toLowerCase();
                    } else {
                        // For other words (non-minor, not start of new sentence/subtitle):
                        // If the user capitalized it in Sentence Case (e.g., "Juan"), keep it.
                        // Otherwise, convert to lowercase (e.g., "loco", "LOCO" -> "loco").
                        if (processedWord.charAt(0) === processedWord.charAt(0).toUpperCase() && processedWord.slice(1) === processedWord.slice(1).toLowerCase()) {
                            // Keep as is (assumed proper noun or intentionally capitalized by user)
                        } else {
                            processedWord = processedWord.toLowerCase(); // Convert to lowercase
                        }
                    }

                    formattedWords.push(processedWord + trailingPunctuation);
                    capitalizeNextWord = triggersNewCapitalization;
                }

                return formattedWords.join(' ');
            }

            // Función para formatear texto en "Title Case" (cada palabra importante capitalizada)
            function formatForTitleCase(textString) {
                if (!textString) return '';

                const minorWords = new Set([
                    'a', 'ante', 'bajo', 'cabe', 'con', 'contra', 'de', 'desde', 'durante', 'en', 'entre', 'hacia', 'hasta', 'mediante', 'para', 'por', 'según', 'sin', 'so', 'sobre', 'tras', 'versus', 'vía', // preposiciones
                    'y', 'e', 'ni', 'o', 'u', // conjunciones
                    'el', 'la', 'los', 'las', 'un', 'una', 'unos', 'unas', // artículos
                    'pero', 'mas', 'sino', 'aunque', 'porque', 'pues', 'si', 'cuando', 'como', 'donde', 'que' // other common conjunctions/adverbs
                ]);

                return textString.split(/\s+/).map((word, index) => { // Split by one or more spaces
                    if (word.length === 0) return '';
                    let processedWord = word;

                    // Handle all caps words: convert to Title Case
                    if (processedWord === processedWord.toUpperCase() && processedWord.toLowerCase() !== processedWord) {
                        return processedWord.charAt(0).toUpperCase() + processedWord.slice(1).toLowerCase();
                    }
                    // If it's the first word or not a minor word, capitalize the first letter
                    else if (index === 0 || !minorWords.has(processedWord.toLowerCase())) {
                        return processedWord.charAt(0).toUpperCase() + processedWord.slice(1).toLowerCase();
                    }
                    return processedWord.toLowerCase(); // Keep in lowercase if it's a minor word and not the first
                }).join(' ');
            }


            // Función para obtener el tipo de documento seleccionado
            function getSelectedDocumentType() {
                if (documentTypeFormalSelect.value) return documentTypeFormalSelect.value;
                if (documentTypeDigitalSelect.value) return documentTypeDigitalSelect.value;
                return '';
            }

            // Función para limpiar todos los campos de entrada
            function clearAllSpecificFields() {
                authorNameInput.value = '';
                publicationDateWebsiteInput.value = '';
                articleTitleInput.value = '';
                websiteNameInput.value = '';
                pageUrlInput.value = '';
                publicationYearBookInput.value = '';
                bookTitleInput.value = '';
                publisherInput.value = '';
                isbnInput.value = '';
                publicationYearJournalInput.value = '';
                journalArticleTitleInput.value = '';
                journalNameInput.value = '';
                journalVolumeInput.value = '';
                journalIssueInput.value = '';
                pageRangeInput.value = '';
                doiInput.value = '';
                chapterAuthorNameInput.value = '';
                chapterPublicationYearInput.value = '';
                chapterTitleInput.value = '';
                bookEditorNameInput.value = '';
                bookTitleChapterInput.value = '';
                chapterPageRangeInput.value = '';
                publisherChapterInput.value = '';
                doiChapterInput.value = '';
                thesisAuthorNameInput.value = '';
                thesisPublicationYearInput.value = '';
                thesisTitleInput.value = '';
                thesisTypeSelect.value = 'Tesis de maestría no publicada';
                universityNameInput.value = '';
                thesisUrlInput.value = '';
                reportAuthorNameInput.value = '';
                reportPublicationYearInput.value = '';
                reportTitleInput.value = '';
                reportNumberInput.value = '';
                reportPublisherInput.value = '';
                reportUrlInput.value = '';
                videoAuthorNameInput.value = '';
                videoPublicationDateInput.value = '';
                videoTitleInput.value = '';
                videoPlatformInput.value = '';
                videoUrlInput.value = '';
                socialMediaAuthorNameInput.value = '';
                socialMediaUsernameInput.value = '';
                socialMediaPublicationDateInput.value = '';
                socialMediaContentInput.value = '';
                // socialMediaTypeSelect ha sido eliminado
                const socialMediaPlatformInput = document.getElementById('socialMediaPlatform');
                const socialMediaUrlInput = document.getElementById('socialMediaUrl');
                dictionaryAuthorNameInput.value = '';
                dictionaryPublicationYearInput.value = '';
                dictionaryEntryTitleInput.value = '';
                dictionaryNameInput.value = '';
                dictionaryUrlInput.value = '';
            }

            // Función para mostrar/ocultar campos según el tipo de documento seleccionado
            function toggleFieldsVisibility() {
                const selectedType = getSelectedDocumentType();

                // Ocultar todos los campos específicos y el común de autor por defecto
                commonFieldsDiv.classList.add('hidden');
                websiteFieldsDiv.classList.add('hidden');
                bookFieldsDiv.classList.add('hidden');
                journalArticleFieldsDiv.classList.add('hidden');
                bookChapterFieldsDiv.classList.add('hidden');
                thesisFieldsDiv.classList.add('hidden');
                reportFieldsDiv.classList.add('hidden');
                videoFieldsDiv.classList.add('hidden');
                socialMediaFieldsDiv.classList.add('hidden');
                dictionaryEntryFieldsDiv.classList.add('hidden');

                // Mostrar campos según el tipo seleccionado
                if (selectedType === 'website') {
                    commonFieldsDiv.classList.remove('hidden');
                    websiteFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'book') {
                    commonFieldsDiv.classList.remove('hidden');
                    bookFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'journalArticle') {
                    commonFieldsDiv.classList.remove('hidden');
                    journalArticleFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'bookChapter') {
                    bookChapterFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'thesis') {
                    thesisFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'report') {
                    reportFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'video') {
                    videoFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'socialMedia') {
                    socialMediaFieldsDiv.classList.remove('hidden');
                } else if (selectedType === 'dictionaryEntry') {
                    dictionaryEntryFieldsDiv.classList.remove('hidden');
                }
                // El tipo 'personalCommunication' y sus campos han sido eliminados
            }

            // Event listeners para los selectores de tipo de documento
            documentTypeFormalSelect.addEventListener('change', () => {
                documentTypeDigitalSelect.value = '';
                clearAllSpecificFields();
                toggleFieldsVisibility();
            });

            documentTypeDigitalSelect.addEventListener('change', () => {
                documentTypeFormalSelect.value = '';
                clearAllSpecificFields();
                toggleFieldsVisibility();
            });

            // Llamada inicial para configurar los campos al cargar la página
            clearAllSpecificFields();
            toggleFieldsVisibility();

            // Event listener para el botón de generar cita
            generateCitationBtn.addEventListener('click', () => {
                const docType = getSelectedDocumentType();
                let citation = '';
                let isValid = true;

                citationOutput.textContent = 'La cita aparecerá aquí.';
                copyCitationBtn.style.display = 'none';
                messageBox.style.display = 'none';

                if (!docType) {
                    showMessage('Por favor, selecciona un tipo de documento.', 'error');
                    return;
                }

                // Define currentDate and formattedRetrievalDate once for all digital types
                const currentDate = new Date();
                const formattedRetrievalDate = currentDate.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });

                // Lógica para generar la cita según el tipo de documento
                if (docType === 'website') {
                    const author = formatAuthorsForReference(authorNameInput.value.trim());
                    const publicationDate = publicationDateWebsiteInput.value.trim();
                    const articleTitle = formatTitleForSentenceCase(articleTitleInput.value.trim()); // Aplicar Sentence Case
                    const websiteName = formatForTitleCase(websiteNameInput.value.trim()); // Aplicar Title Case
                    const pageUrl = pageUrlInput.value.trim();

                    if (!articleTitle || !websiteName || !pageUrl) {
                        showMessage('Para Página Web: rellena el Título del Artículo, Nombre del Sitio Web y URL.', 'error');
                        isValid = false;
                    } else {
                        const formattedPublicationDate = publicationDate ? `(${formatDateForReference(publicationDate)})` : '(s.f.)';
                        
                        // Eliminar el punto extra después del autor si ya lo tiene
                        const authorSuffix = author.endsWith('.') ? '' : '.';
                        if (author) {
                            citation = `${author}${authorSuffix} (${formattedPublicationDate}). <i>${articleTitle}</i>. ${websiteName}. Recuperado ${formattedRetrievalDate}, de ${pageUrl}`;
                        } else {
                            citation = `<i>${articleTitle}</i>. (${formattedPublicationDate}). ${websiteName}. Recuperado ${formattedRetrievalDate}, de ${pageUrl}`;
                        }
                    }
                } else if (docType === 'book') {
                    const author = formatAuthorsForReference(authorNameInput.value.trim());
                    const year = publicationYearBookInput.value.trim();
                    const bookTitle = formatTitleForSentenceCase(bookTitleInput.value.trim()); // Aplicar Sentence Case
                    const publisher = formatForTitleCase(publisherInput.value.trim()); // Aplicar Title Case a la editorial
                    const isbn = isbnInput.value.trim();

                    if (!author || !year || !bookTitle || !publisher) {
                        showMessage('Para Libro: rellena el Autor, Año de Publicación, Título del Libro y Editorial.', 'error');
                        isValid = false;
                    } else {
                        // Eliminar el punto extra después del autor si ya lo tiene
                        const authorSuffix = author.endsWith('.') ? '' : '.';
                        citation = `${author}${authorSuffix} (${year}). <i>${bookTitle}</i>. ${publisher}.`;
                        if (isbn) {
                            citation += ` ISBN ${isbn}.`;
                        }
                    }
                } else if (docType === 'journalArticle') {
                    const author = formatAuthorsForReference(authorNameInput.value.trim());
                    const year = publicationYearJournalInput.value.trim();
                    const journalArticleTitle = formatTitleForSentenceCase(journalArticleTitleInput.value.trim()); // Aplicar Sentence Case
                    const journalName = formatForTitleCase(journalNameInput.value.trim()); // Aplicar Title Case
                    const journalVolume = journalVolumeInput.value.trim();
                    const journalIssue = journalIssueInput.value.trim();
                    const pageRange = pageRangeInput.value.trim();
                    const doi = doiInput.value.trim();

                    if (!author || !year || !journalArticleTitle || !journalName) {
                        showMessage('Para Publicación o Artículo: rellena Autor, Año de Publicación, Título del Artículo y Nombre de la Publicación/Revista.', 'error');
                        isValid = false;
                    } else {
                        let issuePart = journalIssue ? `(${journalIssue})` : '';
                        let volumePart = journalVolume ? `<i>${journalVolume}</i>` : '';
                        let pagesPart = pageRange ? `, ${pageRange}` : '';
                        let doiUrl = '';

                        if (doi) {
                            let formattedDoi = doi.trim();
                            if (!formattedDoi.startsWith('http://') && !formattedDoi.startsWith('https://')) {
                                formattedDoi = `https://doi.org/${formattedDoi}`;
                            }
                            doiUrl = formattedDoi;
                        }

                        let journalDetails = `<i>${journalName}</i>`;
                        if (volumePart) {
                            journalDetails += `, ${volumePart}${issuePart}`;
                        } else if (journalIssue) {
                            journalDetails += `, ${issuePart}`;
                        }
                        
                        journalDetails += `${pagesPart}`;
                        
                        // Eliminar el punto extra después del autor si ya lo tiene
                        const authorSuffix = author.endsWith('.') ? '' : '.';
                        citation = `${author}${authorSuffix} (${year}). ${journalArticleTitle}. ${journalDetails}.`; 
                        if (doiUrl) {
                            citation += ` ${doiUrl}`;
                        }
                    }
                } else if (docType === 'bookChapter') {
                    const chapterAuthor = formatAuthorsForReference(chapterAuthorNameInput.value.trim());
                    const chapterYear = chapterPublicationYearInput.value.trim();
                    const chapterTitle = formatTitleForSentenceCase(chapterTitleInput.value.trim()); // Aplicar Sentence Case
                    const bookEditor = formatAuthorsForReference(bookEditorNameInput.value.trim());
                    const bookTitle = formatTitleForSentenceCase(bookTitleChapterInput.value.trim()); // Aplicar Sentence Case
                    const chapterPageRange = chapterPageRangeInput.value.trim();
                    const publisherChapter = formatForTitleCase(publisherChapterInput.value.trim()); // Aplicar Title Case a la editorial
                    const doiChapter = doiChapterInput.value.trim();

                    if (!chapterAuthor || !chapterYear || !chapterTitle || !bookEditor || !bookTitle || !publisherChapter) {
                        showMessage('Para Capítulo de Libro: rellena Autor del Capítulo, Año, Título del Capítulo, Editor(es) del Libro, Título del Libro y Editorial.', 'error');
                        isValid = false;
                    } else {
                        let pagesPart = chapterPageRange ? `(pp. ${chapterPageRange})` : '';
                        let doiPart = doiChapter ? ` ${doiChapter}` : '';
                        
                        // Eliminar el punto extra después del autor del capítulo si ya lo tiene
                        const chapterAuthorSuffix = chapterAuthor.endsWith('.') ? '' : '.';
                        citation = `${chapterAuthor}${chapterAuthorSuffix} (${chapterYear}). ${chapterTitle}. En ${bookEditor} (Ed.${bookEditor.includes('&') ? 's' : ''}), <i>${bookTitle}</i> ${pagesPart}. ${publisherChapter}.${doiPart}`;
                    }
                } else if (docType === 'thesis') {
                    const thesisAuthor = formatAuthorsForReference(thesisAuthorNameInput.value.trim());
                    const thesisYear = thesisPublicationYearInput.value.trim();
                    const thesisTitle = formatTitleForSentenceCase(thesisTitleInput.value.trim()); // Aplicar Sentence Case
                    const thesisType = thesisTypeSelect.value.trim();
                    const universityName = formatForTitleCase(universityNameInput.value.trim()); // Aplicar Title Case a la universidad
                    const thesisUrl = thesisUrlInput.value.trim();

                    if (!thesisAuthor || !thesisYear || !thesisTitle || !thesisType || !universityName) {
                        showMessage('Para Tesis o Disertación: rellena Autor, Año, Título, Tipo de Tesis y Nombre de la Universidad.', 'error');
                        isValid = false;
                    } else {
                        let urlPart = thesisUrl ? ` ${thesisUrl}` : '';
                        // Eliminar el punto extra después del autor de la tesis si ya lo tiene
                        const thesisAuthorSuffix = thesisAuthor.endsWith('.') ? '' : '.';
                        citation = `${thesisAuthor}${thesisAuthorSuffix} (${thesisYear}). <i>${thesisTitle}</i> [${thesisType}, ${universityName}].${urlPart}`;
                    }
                } else if (docType === 'report') {
                    const reportAuthor = formatAuthorsForReference(reportAuthorNameInput.value.trim()); // Aplicar formato de autor
                    const reportYear = reportPublicationYearInput.value.trim();
                    const reportTitle = formatTitleForSentenceCase(reportTitleInput.value.trim()); // Aplicar Sentence Case
                    const reportNumber = reportNumberInput.value.trim();
                    const reportPublisher = formatForTitleCase(reportPublisherInput.value.trim()); // Aplicar Title Case a la editorial
                    const reportUrl = reportUrlInput.value.trim();

                    if (!reportAuthor || !reportYear || !reportTitle) {
                        showMessage('Para Informe: rellena Autor/Organización, Año de Publicación y Título del Informe.', 'error');
                        isValid = false;
                    } else {
                        let numberPart = reportNumber ? ` (${reportNumber})` : '';
                        let publisherPart = reportPublisher && reportPublisher !== reportAuthor ? `. ${reportPublisher}` : '';
                        let urlPart = reportUrl ? ` ${reportUrl}` : '';

                        // Eliminar el punto extra después del autor del informe si ya lo tiene
                        const reportAuthorSuffix = reportAuthor.endsWith('.') ? '' : '.';
                        citation = `${reportAuthor}${reportAuthorSuffix} (${reportYear}). <i>${reportTitle}</i>${numberPart}.${publisherPart}${urlPart}`;
                    }
                } else if (docType === 'video') {
                    const videoAuthor = formatAuthorsForReference(videoAuthorNameInput.value.trim()); // Aplicar formato de autor
                    const videoDate = videoPublicationDateInput.value.trim();
                    const videoTitle = formatTitleForSentenceCase(videoTitleInput.value.trim()); // Aplicar Sentence Case
                    const videoPlatform = formatForTitleCase(videoPlatformInput.value.trim()); // Aplicar Title Case
                    const videoUrl = videoUrlInput.value.trim();

                    if (!videoAuthor || !videoDate || !videoTitle || !videoPlatform || !videoUrl) {
                        showMessage('Para Video: rellena Autor/Canal, Fecha de Publicación, Título del Video, Plataforma y URL.', 'error');
                        isValid = false;
                    } else {
                        const formattedVideoDate = videoDate ? `(${formatDateForReference(videoDate)})` : '(s.f.)';
                        // Eliminar el punto extra después del autor del video si ya lo tiene
                        const videoAuthorSuffix = videoAuthor.endsWith('.') ? '' : '.';
                        citation = `${videoAuthor}${videoAuthorSuffix} ${formattedVideoDate}. <i>${videoTitle}</i> [Video]. ${videoPlatform}. Recuperado ${formattedRetrievalDate}, de ${videoUrl}`;
                    }
                } else if (docType === 'socialMedia') {
                    const smAuthorName = formatAuthorsForReference(socialMediaAuthorNameInput.value.trim()); // Aplicar formato de autor
                    const smUsername = socialMediaUsernameInput.value.trim();
                    const smDate = socialMediaPublicationDateInput.value.trim();
                    let smContent = socialMediaContentInput.value.trim(); // Make it mutable
                    const smPlatform = formatForTitleCase(socialMediaPlatformInput.value.trim()); // Aplicar Title Case
                    const smUrl = socialMediaUrlInput.value.trim();

                    if (!smAuthorName || !smUsername || !smDate || !smContent || !smPlatform || !smUrl) {
                        showMessage('Para Publicación de Red Social: rellena Autor, Nombre de Usuario, Fecha, Contenido, Plataforma y URL.', 'error');
                        isValid = false;
                    } else {
                        // Step 1: Remove URLs
                        smContent = smContent.replace(/(https?:\/\/[^\s]+)/g, '');

                        // Step 2: Remove Hashtags
                        smContent = smContent.replace(/#(\w+)/g, '');

                        // Step 3: Remove Emojis (using a broad Unicode range for common emojis)
                        // This regex targets various emoji blocks.
                        smContent = smContent.replace(/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g, '');
                        
                        // Remove any extra spaces that might result from removals
                        smContent = smContent.replace(/\s+/g, ' ').trim();

                        const formattedSmDate = smDate ? `(${formatDateForReference(smDate)})` : '(s.f.)';
                        const contentSnippet = formatTitleForSentenceCase(smContent.split(/\s+/).slice(0, 20).join(' ')); // Aplicar Sentence Case al snippet
                        const contentFormatted = contentSnippet.length > 0 ? `"${contentSnippet}"` : '';
                        
                        // The citation now includes "[Publicación]" as the type
                        // smAuthorName already has the dot if needed, and the dot after username is part of APA format
                        citation = `${smAuthorName} [${smUsername}]. ${formattedSmDate}. ${contentFormatted} [Publicación]. ${smPlatform}. Recuperado ${formattedRetrievalDate}, de ${smUrl}`;
                    }
                } else if (docType === 'dictionaryEntry') {
                    const dictAuthor = formatAuthorsForReference(dictionaryAuthorNameInput.value.trim()); // Aplicar formato de autor
                    const dictYear = dictionaryPublicationYearInput.value.trim();
                    const dictEntryTitle = formatTitleForSentenceCase(dictionaryEntryTitleInput.value.trim()); // Aplicar Sentence Case
                    const dictName = formatForTitleCase(dictionaryNameInput.value.trim()); // Aplicar Title Case
                    const dictUrl = dictionaryUrlInput.value.trim();

                    if (!dictEntryTitle || !dictName || !dictUrl) {
                        showMessage('Para Entrada de Diccionario/Enciclopedia Online: rellena Título de la Entrada, Nombre del Diccionario/Enciclopedia y URL.', 'error');
                        isValid = false;
                    } else {
                        const yearPart = dictYear ? `(${dictYear})` : '(s.f.)';
                        // Eliminar el punto extra después del autor si ya lo tiene
                        let authorPart = dictAuthor ? `${dictAuthor}${dictAuthor.endsWith('.') ? '' : '.'} ` : '';
                        
                        citation = `${authorPart}${yearPart}. ${dictEntryTitle}. En <i>${dictName}</i>. Recuperado ${formattedRetrievalDate}, de ${dictUrl}`;
                    }
                }

                if (!isValid) {
                    citationOutput.textContent = 'La cita aparecerá aquí.';
                    copyCitationBtn.style.display = 'none';
                    return;
                }

                citationOutput.innerHTML = citation;
                copyCitationBtn.style.display = 'block';
                showMessage('Cita generada con éxito.', 'success');
            });

            // Event listener para el botón de copiar cita
            copyCitationBtn.addEventListener('click', () => {
                const citationText = citationOutput.innerText;
                const textArea = document.createElement('textarea');
                textArea.value = citationText;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showMessage('Cita copiada al portapapeles.', 'success');
                } catch (err) {
                    showMessage('Error al copiar la cita. Por favor, cópiala manualmente.', 'error');
                }
                document.body.removeChild(textArea);
            });
        });
    </script>
</body>
</html>
